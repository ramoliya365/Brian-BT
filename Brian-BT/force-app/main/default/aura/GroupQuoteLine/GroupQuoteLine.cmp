<aura:component implements="flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes"  access="global" Controller="QuoteDAO">
    <aura:attribute name="GroupingOptions" type="List" />
    <aura:attribute name="valueofField1" type="string" />
    <aura:attribute name="valueofField2" type="string" />
    <aura:attribute name="valueofField3" type="string" />
    <aura:attribute name="valueofField4" type="string" />
    <aura:attribute name="displayGrouping" type="Boolean" default="false" />
    <aura:attribute name="groupFieldList" type="List" />
    <aura:attribute name="QuoteLineWrapper" type="Object" />
    <aura:attribute name="totalColumn" type="Integer" />
    <aura:attribute name="firstGrouping" type="Boolean" default="false" />
    <aura:attribute name="secondGrouping" type="Boolean" default="false" />
    <aura:attribute name="thirdGrouping" type="Boolean" default="false" />
    <aura:attribute name="forthGrouping" type="Boolean" default="false" />
    <aura:attribute name="TotalRecordCount" type="Integer" default="0" />
    <aura:attribute name="CollapeCount" type="Integer" default="0" />
    <aura:attribute name="displayRecordList" type="List" />
    <aura:attribute name="isBOMmodalOpen" type="boolean" default="false" />
    <aura:handler name="init" value="{!this}"  action="{!c.doInit}" />

    <aura:attribute name="PopupHeader" type="String" default="" />
    <aura:attribute name="PopupDescription" type="String" default="" />
    <aura:attribute name="isDuplicate" type="Boolean" default="false" />
    <aura:attribute name="openPopup" type="Boolean" default="false" />
    <aura:attribute name="currentId" type="String" default="" />







    <aura:if isTrue="{!v.openPopup}">
        <div class="slds-m-around_xx-large">
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"  aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <header class="slds-modal__header">
                        <!-- <aura:if isTrue="{!v.isOpen}"> -->
                            <lightning:buttonIcon iconName="utility:close" onclick="{!c.closeModel}"   alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                        <!-- </aura:if> -->
                        <!-- <aura:if isTrue="{!or(v.isDuplicate,v.isMassDuplicate)}">
                            <lightning:buttonIcon iconName="utility:close" onclick="{!c.closeDuplicateModel}" alternativeText="close"   variant="bare-inverse" class="slds-modal__close" />
                        </aura:if> -->

                        <!-- <aura:if isTrue="{!v.isQuoteRecChange}">
                            <lightning:buttonIcon iconName="utility:close"
                                onclick="{!c.closeModelQuoteRec}" alternativeText="close"
                                variant="bare-inverse" class="slds-modal__close" />
                        </aura:if> -->
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
                            {!v.PopupHeader}</h2>
                    </header>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <center>
                            <h2>{!v.PopupDescription}</h2>
                        </center>
                    </div>
                    <footer class="slds-modal__footer">
                        <lightning:button variant="neutral" label="Cancel" title="Cancel"  onclick="{!c.closeModel}" />
                        <!-- <aura:if isTrue="{!v.isOpen}">
                            
                            <lightning:button variant="brand" label="Delete" title="Delete" onclick="{!c.deleteQuoteItems}" />
                        </aura:if> -->

                        <aura:if isTrue="{!v.isDuplicate}">
                            <lightning:button variant="brand" label="Duplicate" title="Duplicate" onclick="{!c.duplicateQuote}" />
                        </aura:if>
                        
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </div>
    </aura:if>

    <!-- <aura:if isTrue="{!v.displayGrouping}"> -->
    <table class="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal">
        <tbody>
            <aura:if isTrue="{!v.firstGrouping}">
                <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                    <tr>
                        <td class="groupHeaderIcon">
                            <div id='collapseBtn' class="slds-float_left">
                                <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                    <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                </span>
                                <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex}" onclick="{!c.expandCollapeGroup}"  style="display:inline-block;">
                                    <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                </span>
                            </div>
                        </td>
                        <td class="groupHeaderDiv" colspan="{!v.totalColumn+3}">
                            <aura:if isTrue="{!group1.groupName != undefined}">
                                {!group1.groupName}
                                <aura:set attribute="else">
                                    No Grouping
                                </aura:set>
                            </aura:if>
                        </td>
                    </tr>
                    <tr style='line-height: 2;font-size: 12px;' class="slds-text-heading--label">
                        <th class="tableHeaderDiv blankDiv"></th>
                        <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                            <th class="tableHeaderDiv">
                                {!col.label}
                            </th>
                        </aura:iteration>
                    </tr>
                    <aura:iteration items="{!group1.quoteLineList}" var="quoteItem">
                        <tr style="line-height: 2.5;display:table-row;" class="{!'record_'+group1.groupIndex}" >
                            <!-- <td class="blankDiv"> </td> -->
                            <td style="text-align:left;">
                                <div class="slds-truncate">
                                    <span data-id="{!quoteItem.Id}"  onclick="{!c.onclickDuplicate}">
                                        <lightning:icon iconName="utility:copy" size="xx-small" />
                                        &nbsp;
                                    </span>
                                    <span data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                        <lightning:icon iconName="utility:edit" size="xx-small" />
                                        &nbsp;
                                    </span>
                                    <span data-id="{!quoteItem.Id}" onclick="{!c.deleteQuote}">
                                        <lightning:icon iconName="utility:delete" size="xx-small" />
                                    </span>
                                </div>
                            </td>
                            <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                <td>
                                    <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                        || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                        <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                            <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                        </aura:if>

                                        <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                <aura:set attribute="else">
                                                    <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                </aura:set>
                                            </aura:if>
                                        </aura:if>

                                        <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                <aura:set attribute="else">
                                                    <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                </aura:set>
                                            </aura:if>
                                        </aura:if>

                                        <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                        fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                <aura:set attribute="else">
                                                    <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                </aura:set>
                                            </aura:if>
                                        </aura:if>

                                        <aura:set attribute="else">
                                            {!fildData.fieldValue}
                                        </aura:set>
                                    </aura:if>
                                </td>
                            </aura:iteration>
                        </tr>
                    </aura:iteration>
                    <tr style="font-weight: bold;">
                        <td class="blankDiv"> </td>
                        <aura:iteration items="{!group1.fieldTotals.fieldTotalList}"
                            var="total">
                            <td>
                                <aura:if isTrue="{!total.fieldName == 'Total'}">
                                    <span>Total</span>
                                </aura:if>
                                <aura:if isTrue="{!total.fieldType == 'currency'}">
                                    <aura:if isTrue="{!total.fieldValue != null}">
                                        <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                        <aura:set attribute="else">
                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                        </aura:set>
                                    </aura:if>
                                </aura:if>
                            </td>
                        </aura:iteration>
                    </tr>
                </aura:iteration>
            </aura:if>

            <aura:if isTrue="{!v.secondGrouping}">
                <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                    <tr>
                        <td class="groupHeaderDiv" colspan="2">
                            <aura:if isTrue="{!group1.groupName != undefined}">
                                {!group1.groupName}
                                <aura:set attribute="else">
                                    No Grouping
                                
                                </aura:set>
                            </aura:if>
                        </td>
                        <aura:iteration items="{!group1.fieldTotals.fieldTotalList}" var="total">
                            <td class="groupHeaderTotal">
                                <aura:if isTrue="{!total.fieldName == 'Total'}">
                                        <span>Total</span>
                                </aura:if>
                                <aura:if isTrue="{!total.fieldType == 'currency'}">
                                    <aura:if isTrue="{!total.fieldValue != null}">
                                        <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                        <aura:set attribute="else">
                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                        </aura:set>
                                    </aura:if>
                                </aura:if>
                            </td>
                        </aura:iteration>
                    </tr>
                    
                    <aura:iteration items="{!group1.quoteLineList}" var="group2">
                        <tr>
                            <td class="groupHeaderIcon">
                                <div id='collapseBtn' class="slds-float_left">
                                    <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex+group2.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                        <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                    </span>
                                    <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex+group2.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:inline-block;">
                                        <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                    </span>
                                </div>
                            </td>
                            <td class="groupHeaderDiv" colspan="{!v.totalColumn+3}">
                                <aura:if isTrue="{!group2.groupName != undefined}">
                                    {!group2.groupName}
                                    <aura:set attribute="else">
                                        No Grouping
                                    </aura:set>
                                </aura:if>
                            </td>
                        </tr>
                        <tr>
                            <th class="tableHeaderDiv blankDiv"></th>
                            <th class="tableHeaderDiv blankDiv"></th>

                            <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                <th class="tableHeaderDiv">
                                    {!col.label}
                                </th>
                            </aura:iteration>
                        </tr>
                        <aura:iteration items="{!group2.quoteLineList}" var="quoteItem">
                            <tr class="{!'record_'+group1.groupIndex+group2.groupIndex}">
                                <td class="blankDiv"> </td>
                                <td style="text-align:left;">
                                    <div class="slds-truncate">
                                        <span data-id="{!quoteItem.Id}" onclick="{!c.onclickDuplicate}">
                                            <lightning:icon iconName="utility:copy" size="xx-small" />
                                            &nbsp;
                                        </span>
                                        <span  data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                            <lightning:icon iconName="utility:edit" size="xx-small" />
                                            &nbsp;
                                        </span>
                                        <span data-id="{!quoteItem.Id}" onclick="{!c.deleteQuote}">
                                            <lightning:icon iconName="utility:delete" size="xx-small" />
                                        </span>
                                    </div>
                                </td>  
                                <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                    <td>
                                        <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                            || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                            <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                            </aura:if>

                                            <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                <aura:if isTrue="{!fildData.fieldValue != null}">
                                                    <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                    <aura:set attribute="else">
                                                        <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                    </aura:set>
                                                </aura:if>
                                            </aura:if>

                                            <aura:if
                                                isTrue="{!fildData.fieldType == 'currency'}">
                                                <aura:if isTrue="{!fildData.fieldValue != null}">
                                                    <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                    <aura:set attribute="else">
                                                        <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                    </aura:set>
                                                </aura:if>
                                            </aura:if>

                                            <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                            fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                <aura:if
                                                    isTrue="{!fildData.fieldValue != null}">
                                                    <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                    <aura:set attribute="else">
                                                        <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                    </aura:set>
                                                </aura:if>
                                            </aura:if>

                                            <aura:set attribute="else">
                                                {!fildData.fieldValue}
                                            </aura:set>
                                        </aura:if>
                                    </td>
                                </aura:iteration>
                            </tr>
                        </aura:iteration>
                        <tr style="font-weight: bold;">
                            <td class="blankDiv"> </td>
                            <td class="blankDiv"> </td>
                            <aura:iteration items="{!group2.fieldTotals.fieldTotalList}"
                                var="total">
                                <td>
                                    <aura:if isTrue="{!total.fieldName == 'Total'}">
                                        <span>Total</span>
                                    </aura:if>
                                    <aura:if isTrue="{!total.fieldType == 'currency'}">
                                        <aura:if isTrue="{!total.fieldValue != null}">
                                            <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                            <aura:set attribute="else">
                                                <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                </td>
                            </aura:iteration>
                        </tr>
                        <br/>
                    </aura:iteration>
                    
                </aura:iteration>
            </aura:if>


            <aura:if isTrue="{!v.thirdGrouping}">
                <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                    <tr>
                        <td class="groupHeaderDiv" colspan="3">
                            <aura:if isTrue="{!group1.groupName != undefined}">
                                {!group1.groupName}
                                <aura:set attribute="else">
                                    No Grouping
                                </aura:set>
                            </aura:if>
                        </td>
                        <aura:iteration items="{!group1.fieldTotals.fieldTotalList}" var="total">
                            <td class="groupHeaderTotal">
                                <aura:if isTrue="{!total.fieldName == 'Total'}">
                                    <span>Total</span>
                                </aura:if>
                                <aura:if isTrue="{!total.fieldType == 'currency'}">
                                    <aura:if isTrue="{!total.fieldValue != null}">
                                        <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                        <aura:set attribute="else">
                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                        </aura:set>
                                    </aura:if>
                                </aura:if>
                            </td>
                        </aura:iteration>
                    </tr>
                    <aura:iteration items="{!group1.quoteLineList}" var="group2">
                        <tr>
                            <td class="groupHeaderDiv blankDiv"> </td>
                            <td class="groupHeaderDiv" colspan="2">
                                <aura:if isTrue="{!group2.groupName != undefined}">
                                    {!group2.groupName}
                                    <aura:set attribute="else">
                                        No Grouping
                                    </aura:set>
                                </aura:if>
                            </td>

                            <aura:iteration items="{!group2.fieldTotals.fieldTotalList}" var="total">
                                <td class="groupHeaderTotal">
                                    <aura:if isTrue="{!total.fieldName == 'Total'}">
                                        <span>Total</span>
                                    </aura:if>
                                    <aura:if isTrue="{!total.fieldType == 'currency'}">
                                        <aura:if isTrue="{!total.fieldValue != null}">
                                            <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                            <aura:set attribute="else">
                                                <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                </td>
                            </aura:iteration>
                        </tr>
                        <aura:iteration items="{!group2.quoteLineList}" var="group3">
                            <tr>
                                <td class="groupHeaderDiv blankDiv"> </td>
                                <td class="groupHeaderIcon">
                                    <div id='collapseBtn' class="slds-float_left">
                                        <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                            <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                        </span>
                                        <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:inline-block;">
                                            <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                        </span>
                                    </div>
                                </td>
                                <td class="groupHeaderDiv" colspan="{!v.totalColumn+2}">
                                    <aura:if isTrue="{!group3.groupName != undefined}">
                                        {!group3.groupName}
                                        <aura:set attribute="else">
                                            No Grouping
                                        </aura:set>
                                    </aura:if>
                                </td>
                            </tr>
                            <tr>
                                <th class="tableHeaderDiv blankDiv"></th>
                                <th class="tableHeaderDiv blankDiv"></th>
                                <th class="tableHeaderDiv blankDiv"></th>
                                <aura:iteration items="{!v.QuoteLineWrapper.columns}"
                                    var="col">
                                    <th class="tableHeaderDiv">
                                        {!col.label}
                                    </th>
                                </aura:iteration>
                            </tr>
                            <aura:iteration items="{!group3.quoteLineList}" var="quoteItem">
                                <tr
                                    class="{!'record_'+group1.groupIndex+group2.groupIndex+group3.groupIndex}">
                                    <td class="blankDiv"> </td>
                                    <td class="blankDiv"> </td>
                                    <td style="text-align:left;">
                                    <div class="slds-truncate">
                                        <span data-id="{!quoteItem.Id}"  onclick="{!c.onclickDuplicate}">
                                            <lightning:icon iconName="utility:copy" size="xx-small" />
                                            &nbsp;
                                        </span>
                                        <span  data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                            <lightning:icon iconName="utility:edit" size="xx-small" />
                                            &nbsp;
                                        </span>
                                        <span data-id="{!quoteItem.Id}" onclick="{!c.deleteQuote}">
                                            <lightning:icon iconName="utility:delete" size="xx-small" />
                                        </span>
                                    </div>
                                    </td>           
                                    <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                        <td>
                                            <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                    <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                </aura:if>

                                                <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                        <aura:set attribute="else">
                                                            <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:if>

                                                <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                        <aura:set attribute="else">
                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:if>

                                                <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                        <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                        <aura:set attribute="else">
                                                            <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:if>

                                                <aura:set attribute="else">
                                                    {!fildData.fieldValue}
                                                </aura:set>
                                            </aura:if>
                                        </td>
                                    </aura:iteration>
                                </tr>
                            </aura:iteration>
                            <tr style="font-weight: bold;">
                                <td class="blankDiv"> </td>
                                <td class="blankDiv"> </td>
                                <td class="blankDiv"> </td>
                                <aura:iteration items="{!group3.fieldTotals.fieldTotalList}" var="total">
                                    <td>
                                        <aura:if isTrue="{!total.fieldName == 'Total'}">
                                            <span>Total</span>
                                        </aura:if>
                                        <aura:if isTrue="{!total.fieldType == 'currency'}">
                                            <aura:if isTrue="{!total.fieldValue != null}">
                                                <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                <aura:set attribute="else">
                                                    <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                </aura:set>
                                            </aura:if>
                                        </aura:if>
                                    </td>
                                </aura:iteration>
                            </tr>
                            <br/>
                        </aura:iteration>
                        
                    </aura:iteration>
                
                </aura:iteration>
            </aura:if>

            <aura:if isTrue="{!v.forthGrouping}">
                <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                    <tr>
                        <td class="groupHeaderDiv" colspan="4">
                            <aura:if isTrue="{!group1.groupName != undefined}">
                                {!group1.groupName}
                                <aura:set attribute="else">
                                    No Grouping
                                </aura:set>
                            </aura:if>
                        </td>
                        <aura:iteration items="{!group1.fieldTotals.fieldTotalList}" var="total">
                            <td class="groupHeaderTotal">
                                <aura:if isTrue="{!total.fieldName == 'Total'}">
                                    <span>Total</span>
                                </aura:if>
                                <aura:if isTrue="{!total.fieldType == 'currency'}">
                                    <aura:if isTrue="{!total.fieldValue != null}">
                                        <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                        <aura:set attribute="else">
                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                        </aura:set>
                                    </aura:if>
                                </aura:if>
                            </td>
                        </aura:iteration>
                    </tr>
                    <aura:iteration items="{!group1.quoteLineList}" var="group2">
                        <tr>
                            <td class="groupHeaderDiv blankDiv"> </td>
                            <td class="groupHeaderDiv" colspan="3">
                                <aura:if isTrue="{!group2.groupName != undefined}">
                                    {!group2.groupName}
                                    <aura:set attribute="else">
                                        No Grouping
                                    </aura:set>
                                </aura:if>
                            </td>
                            
                            <aura:iteration items="{!group2.fieldTotals.fieldTotalList}" var="total">
                                <td class="groupHeaderTotal">
                                    <aura:if isTrue="{!total.fieldName == 'Total'}">
                                        <span>Total</span>
                                    </aura:if>
                                    <aura:if isTrue="{!total.fieldType == 'currency'}">
                                        <aura:if isTrue="{!total.fieldValue != null}">
                                            <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                            <aura:set attribute="else">
                                                <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                            </aura:set>
                                        </aura:if>
                                    </aura:if>
                                </td>
                            </aura:iteration>
                        </tr>
                        <aura:iteration items="{!group2.quoteLineList}" var="group3">
                            <tr>
                                <td class="groupHeaderDiv blankDiv"> </td>
                                <td class="groupHeaderDiv blankDiv"> </td>
                                <td class="groupHeaderDiv" colspan="2">
                                    <aura:if isTrue="{!group3.groupName != undefined}">
                                        {!group3.groupName}
                                        <aura:set attribute="else">
                                            No Grouping
                                        </aura:set>
                                    </aura:if>
                                </td>
                                <aura:iteration items="{!group3.fieldTotals.fieldTotalList}" var="total">
                                    <td class="groupHeaderTotal">
                                        <aura:if isTrue="{!total.fieldName == 'Total'}">
                                            <span>Total</span>
                                        </aura:if>
                                        <aura:if isTrue="{!total.fieldType == 'currency'}">
                                            <aura:if isTrue="{!total.fieldValue != null}">
                                                <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                <aura:set attribute="else">
                                                    <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                </aura:set>
                                            </aura:if>
                                        </aura:if>
                                    </td>
                                </aura:iteration>
                            </tr>
                            <aura:iteration items="{!group3.quoteLineList}" var="group4">
                                <tr>
                                    <td class="groupHeaderDiv blankDiv"> </td>
                                    <td class="groupHeaderDiv blankDiv"> </td>
                                    <td class="groupHeaderIcon">
                                        <div id='collapseBtn' class="slds-float_left">
                                            <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex+group4.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                                <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                            </span>
                                            <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex+group4.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:inline-block;">
                                                <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                            </span>
                                        </div>
                                    </td>
                                    <td class="groupHeaderDiv" colspan="{!v.totalColumn+1}">
                                        <aura:if isTrue="{!group4.groupName != undefined}">
                                            {!group4.groupName}
                                            <aura:set attribute="else">
                                                No Grouping
                                            </aura:set>
                                        </aura:if>
                                    </td>
                                </tr>
                                <tr>
                                    <th class="tableHeaderDiv blankDiv"></th>
                                    <th class="tableHeaderDiv blankDiv"></th>
                                    <th class="tableHeaderDiv blankDiv"></th>
                                    <th class="tableHeaderDiv blankDiv"></th>
                                    <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                        <th class="tableHeaderDiv">
                                            {!col.label}
                                        </th>
                                    </aura:iteration>
                                </tr>
                                <aura:iteration items="{!group4.quoteLineList}" var="quoteItem">
                                    <tr class="{!'record_'+group1.groupIndex+group2.groupIndex+group3.groupIndex+group4.groupIndex}">
                                        <td class="blankDiv"> </td>
                                        <td class="blankDiv"> </td>
                                        <td class="blankDiv"> </td>
                                        <td style="text-align:left;">
                                            <div class="slds-truncate">
                                                <span data-id="{!quoteItem.Id}" onclick="{!c.onclickDuplicate}">
                                                    <lightning:icon iconName="utility:copy"  size="xx-small" />
                                                    &nbsp;
                                                </span>
                                                <span  data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                                    <lightning:icon iconName="utility:edit" size="xx-small" />
                                                    &nbsp;
                                                </span>
                                                <span data-id="{!quoteItem.Id}"  onclick="{!c.deleteQuote}">
                                                    <lightning:icon iconName="utility:delete" size="xx-small" />
                                                </span>
                                            </div>
                                        </td>                                                                    <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                        <td>
                                                <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                    || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                    <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                        <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                    </aura:if>

                                                    <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                        <aura:if isTrue="{!fildData.fieldValue != null}">
                                                            <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                            <aura:set attribute="else">
                                                                <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                            </aura:set>
                                                        </aura:if>
                                                    </aura:if>

                                                    <aura:if
                                                        isTrue="{!fildData.fieldType == 'currency'}">
                                                        <aura:if isTrue="{!fildData.fieldValue != null}">
                                                            <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                            <aura:set attribute="else">
                                                                <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                            </aura:set>
                                                        </aura:if>
                                                    </aura:if>

                                                    <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                    fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                        <aura:if isTrue="{!fildData.fieldValue != null}">
                                                            <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                            <aura:set attribute="else">
                                                                <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                            </aura:set>
                                                        </aura:if>
                                                    </aura:if>

                                                    <aura:set attribute="else">
                                                        {!fildData.fieldValue}
                                                    </aura:set>
                                                </aura:if>
                                            </td>
                                        </aura:iteration>
                                    </tr>
                                </aura:iteration>
                                <tr style="font-weight: bold;">
                                    <td class="blankDiv"> </td>
                                    <td class="blankDiv"> </td>
                                    <td class="blankDiv"> </td>
                                    <td class="blankDiv"> </td>
                                    <aura:iteration items="{!group4.fieldTotals.fieldTotalList}" var="total">
                                        <td>
                                            <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                <span>Total</span>
                                            </aura:if>
                                            <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                <aura:if isTrue="{!total.fieldValue != null}">
                                                    <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                    <aura:set attribute="else">
                                                        <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                    </aura:set>
                                                </aura:if>
                                            </aura:if>
                                        </td>
                                    </aura:iteration>
                                </tr>
                                <br/>
                            </aura:iteration>
                            
                        </aura:iteration>
                        
                    </aura:iteration>
                
                </aura:iteration>
            </aura:if>

        </tbody>
    </table>
    <!-- </aura:if> -->
</aura:component>