!function(t){t.widget("ui.multiselect",{options:{sortable:!0,searchable:!0,doubleClickable:!0,animated:"fast",show:"slideDown",hide:"slideUp",dividerLocation:.6,availableFirst:!1,nodeComparator:function(t,e){var i=t.text(),s=e.text();return i==s?0:s>i?-1:1}},_create:function(){this.element.hide(),this.id=this.element.attr("id"),this.container=t('<div class="ui-multiselect ui-helper-clearfix ui-widget"></div>').insertAfter(this.element),this.count=0,this.selectedContainer=t('<div class="selected"></div>').appendTo(this.container),this.availableContainer=t('<div class="available"></div>')[this.options.availableFirst?"prependTo":"appendTo"](this.container),this.selectedActions=t('<div class="actions ui-widget-header ui-helper-clearfix"><span class="count">0 '+t.ui.multiselect.locale.itemsCount+'</span><a href="#" class="remove-all">'+t.ui.multiselect.locale.removeAll+"</a></div>").appendTo(this.selectedContainer),this.availableActions=t('<div class="actions ui-widget-header ui-helper-clearfix"><input type="text" class="search empty ui-widget-content ui-corner-all"/><a href="#" class="add-all">'+t.ui.multiselect.locale.addAll+"</a></div>").appendTo(this.availableContainer),this.selectedList=t('<ul class="selected connected-list"><li class="ui-helper-hidden-accessible"></li></ul>').bind("selectstart",function(){return!1}).appendTo(this.selectedContainer),this.availableList=t('<ul class="available connected-list"><li class="ui-helper-hidden-accessible"></li></ul>').bind("selectstart",function(){return!1}).appendTo(this.availableContainer);var e=this;this.container.width(this.element.width()+1),this.selectedContainer.width(Math.floor(this.element.width()*this.options.dividerLocation)),this.availableContainer.width(Math.floor(this.element.width()*(1-this.options.dividerLocation))),this.selectedList.height(Math.max(this.element.height()-this.selectedActions.height(),1)),this.availableList.height(Math.max(this.element.height()-this.availableActions.height(),1)),this.options.animated||(this.options.show="show",this.options.hide="hide"),this.useProp=!!t.fn.prop,this._populateLists(this.element.find("option")),this.options.sortable&&this.selectedList.sortable({placeholder:"ui-state-highlight",axis:"y",update:function(i,s){e.selectedList.find("li").each(function(){t(this).data("optionLink")&&t(this).data("optionLink").remove().appendTo(e.element)})},receive:function(i,s){s.item.data("optionLink")[this.useProp?"prop":"attr"]("selected",!0),e.count+=1,e._updateCount(),e.selectedList.children(".ui-draggable").each(function(){t(this).removeClass("ui-draggable"),t(this).data("optionLink",s.item.data("optionLink")),t(this).data("idx",s.item.data("idx")),e._applyItemState(t(this),!0)}),setTimeout(function(){s.item.remove()},1)}}),this.options.searchable?this._registerSearchEvents(this.availableContainer.find("input.search")):t(".search").hide(),this.container.find(".remove-all").click(function(){return e._populateLists(e.element.find("option").removeAttr("selected")),!1}),this.container.find(".add-all").click(function(){var i=e.element.find("option").not(":selected");return e.availableList.children("li:hidden").length>1?e.availableList.children("li").each(function(s){t(this).is(":visible")&&t(i[s-1])[e.useProp?"prop":"attr"]("selected",!0)}):i[e.useProp?"prop":"attr"]("selected",!0),e._populateLists(e.element.find("option")),!1})},destroy:function(){this.element.show(),this.container.remove(),t.Widget.prototype.destroy.apply(this,arguments)},_populateLists:function(e){this.selectedList.children(".ui-element").remove(),this.availableList.children(".ui-element").remove(),this.count=0;var i=this;t(e.map(function(t){var e=i._getOptionNode(this).appendTo(this.selected?i.selectedList:i.availableList).show();return this.selected&&(i.count+=1),i._applyItemState(e,this.selected),e.data("idx",t),e[0]}));this._updateCount(),i._filter.apply(this.availableContainer.find("input.search"),[i.availableList])},_updateCount:function(){this.element.trigger("change"),this.selectedContainer.find("span.count").text(this.count+" "+t.ui.multiselect.locale.itemsCount)},_getOptionNode:function(e){e=t(e);var i=t('<li class="ui-state-default ui-element" title="'+e.text()+'"><span class="ui-icon"/>'+e.text()+'<a href="#" class="action"><span class="ui-corner-all ui-icon"/></a></li>').hide();return i.data("optionLink",e),i},_cloneWithData:function(t){var e=t.clone(!1,!1);return e.data("optionLink",t.data("optionLink")),e.data("idx",t.data("idx")),e},_setSelected:function(e,i){if(e.data("optionLink")[this.useProp?"prop":"attr"]("selected",i),i){var s=this._cloneWithData(e);return e[this.options.hide](this.options.animated,function(){t(this).remove()}),s.appendTo(this.selectedList).hide()[this.options.show](this.options.animated),this._applyItemState(s,!0),s}var n=this.availableList.find("li"),a=this.options.nodeComparator,o=null,l=e.data("idx"),r=a(e,t(n[l]));if(r){for(;l>=0&&l<n.length;)if(r>0?l++:l--,r!=a(e,t(n[l]))){o=n[r>0?l:l+1];break}}else o=n[l];var c=this._cloneWithData(e);return o?c.insertBefore(t(o)):c.appendTo(this.availableList),e[this.options.hide](this.options.animated,function(){t(this).remove()}),c.hide()[this.options.show](this.options.animated),this._applyItemState(c,!1),c},_applyItemState:function(t,e){e?(this.options.sortable?t.children("span").addClass("ui-icon-arrowthick-2-n-s").removeClass("ui-helper-hidden").addClass("ui-icon"):t.children("span").removeClass("ui-icon-arrowthick-2-n-s").addClass("ui-helper-hidden").removeClass("ui-icon"),t.find("a.action span").addClass("ui-icon-minus").removeClass("ui-icon-plus"),this._registerRemoveEvents(t.find("a.action"))):(t.children("span").removeClass("ui-icon-arrowthick-2-n-s").addClass("ui-helper-hidden").removeClass("ui-icon"),t.find("a.action span").addClass("ui-icon-plus").removeClass("ui-icon-minus"),this._registerAddEvents(t.find("a.action"))),this._registerDoubleClickEvents(t),this._registerHoverEvents(t)},_filter:function(e){var i=t(this),s=e.children("li"),n=s.map(function(){return t(this).text().toLowerCase()}),a=t.trim(i.val().toLowerCase()),o=[];a?(s.hide(),n.each(function(t){this.indexOf(a)>-1&&o.push(t)}),t.each(o,function(){t(s[this]).show()})):s.show()},_registerDoubleClickEvents:function(e){this.options.doubleClickable&&e.dblclick(function(i){0===t(i.target).closest(".action").length&&e.find("a.action").click()})},_registerHoverEvents:function(e){e.removeClass("ui-state-hover"),e.mouseover(function(){t(this).addClass("ui-state-hover")}),e.mouseout(function(){t(this).removeClass("ui-state-hover")})},_registerAddEvents:function(e){var i=this;e.click(function(){i._setSelected(t(this).parent(),!0);return i.count+=1,i._updateCount(),!1}),this.options.sortable&&e.each(function(){t(this).parent().draggable({connectToSortable:i.selectedList,helper:function(){var e=i._cloneWithData(t(this)).width(t(this).width()-50);return e.width(t(this).width()),e},appendTo:i.container,containment:i.container,revert:"invalid"})})},_registerRemoveEvents:function(e){var i=this;e.click(function(){return i._setSelected(t(this).parent(),!1),i.count-=1,i._updateCount(),!1})},_registerSearchEvents:function(e){var i=this;e.focus(function(){t(this).addClass("ui-state-active")}).blur(function(){t(this).removeClass("ui-state-active")}).keypress(function(t){return 13==t.keyCode?!1:void 0}).keyup(function(){i._filter.apply(this,[i.availableList])})}}),t.extend(t.ui.multiselect,{locale:{addAll:"Add all",removeAll:"Remove all",itemsCount:"items selected"}})}(jQuery);