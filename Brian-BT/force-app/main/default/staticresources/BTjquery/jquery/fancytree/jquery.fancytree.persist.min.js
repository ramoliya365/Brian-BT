!function(e,t,o,i){"use strict";function s(t,o,i,r,a){var d,c,l,p,u=!1,f=[],y=[];for(i=i||[],a=a||e.Deferred(),d=0,l=i.length;l>d;d++)c=i[d],p=t.getNodeByKey(c),p?r&&p.isUndefined()?(u=!0,t.debug("_loadLazyNodes: "+p+" is lazy: loading..."),"expand"===r?f.push(p.setExpanded()):f.push(p.load())):(t.debug("_loadLazyNodes: "+p+" already loaded."),p.setExpanded()):(y.push(c),t.debug("_loadLazyNodes: "+p+" was not yet found."));return e.when.apply(e,f).always(function(){if(u&&y.length>0)s(t,o,y,r,a);else{if(y.length)for(t.warn("_loadLazyNodes: could not load those keys: ",y),d=0,l=y.length;l>d;d++)c=i[d],o._appendKey(n,i[d],!1);a.resolve()}}),a}var r=e.ui.fancytree.assert,a="active",n="expanded",d="focus",c="selected";e.ui.fancytree._FancytreeClass.prototype.clearCookies=function(e){var t=this.ext.persist,o=t.cookiePrefix;e=e||"active expanded focus selected",e.indexOf(a)>=0&&t._data(o+a,null),e.indexOf(n)>=0&&t._data(o+n,null),e.indexOf(d)>=0&&t._data(o+d,null),e.indexOf(c)>=0&&t._data(o+c,null)},e.ui.fancytree._FancytreeClass.prototype.getPersistData=function(){var e=this.ext.persist,t=e.cookiePrefix,o=e.cookieDelimiter,i={};return i[a]=e._data(t+a),i[n]=(e._data(t+n)||"").split(o),i[c]=(e._data(t+c)||"").split(o),i[d]=e._data(t+d),i},e.ui.fancytree._FancytreeClass.prototype.setPersistData=function(e){var t=this.ext.persist,e=(t.cookiePrefix,t.cookieDelimiter,JSON.parse(e));t.storeExpanded&&t._data(t.cookiePrefix+n,e[n]),t.storeActive&&t._data(t.cookiePrefix+a,e[a]),t.storeSelected&&t._data(t.cookiePrefix+c,e[c]),t.storeFocus&&t._data(t.cookiePrefix+d,e[d])},e.ui.fancytree.registerExtension({name:"persist",version:"0.3.0",options:{cookieDelimiter:"~",cookiePrefix:i,cookie:{raw:!1,expires:"",path:"",domain:"",secure:!1},expandLazy:!1,overrideSource:!0,store:"auto",types:"active expanded focus selected"},_data:function(t,o){var s=this._local.localStorage;return o===i?s?s.getItem(t):e.cookie(t):void(null===o?s?s.removeItem(t):e.removeCookie(t):s?s.setItem(t,o):e.cookie(t,o,this.options.persist.cookie))},_appendKey:function(t,o,i){o=""+o;var s=this._local,r=this.options.persist,a=r.cookieDelimiter,n=s.cookiePrefix+t,d=s._data(n),c=d?d.split(a):[],l=e.inArray(o,c);l>=0&&c.splice(l,1),i&&c.push(o),s._data(n,c.join(a))},treeInit:function(o){var l=o.tree,p=o.options,u=this._local,f=this.options.persist,y=""!=p.selectedNodes&&p.selectedNodes!=i?JSON.parse(p.selectedNodes):JSON.parse("[]");return r("localStore"===f.store||e.cookie,"Missing required plugin for 'persist' extension: jquery.cookie.js"),u.cookiePrefix=f.cookiePrefix||"fancytree-"+l._id+"-",u.storeActive=f.types.indexOf(a)>=0,u.storeExpanded=f.types.indexOf(n)>=0,u.storeSelected=f.types.indexOf(c)>=0,u.storeFocus=f.types.indexOf(d)>=0,"cookie"!==f.store&&t.localStorage?u.localStorage="local"===f.store?t.localStorage:t.sessionStorage:u.localStorage=null,l.$div.bind("fancytreeinit",function(t){var o,r,_,x,k,v=u._data(u.cookiePrefix+d);o=u._data(u.cookiePrefix+n),x=o&&o.split(f.cookieDelimiter),r=u.storeExpanded?s(l,u,x,f.expandLazy?"expand":!1,null):(new e.Deferred).resolve(),r.done(function(){if(u.storeSelected){if(o=u._data(u.cookiePrefix+c))for(x=o.split(f.cookieDelimiter),_=0;_<x.length;_++)k=l.getNodeByKey(x[_]),k?(k.selected||isNodeSelected(k,y)&&(k.selected===i||f.overrideSource&&k.selected===!1))&&(k.selected&&(k.selected=!1),k.setSelected(),k.selected=!0,k.renderStatus()):u._appendKey(c,x[_],!1);3===l.options.selectMode&&l.visit(function(e){return e.selected?(e.fixSelection3AfterClick(),"skip"):void 0})}u.storeActive&&(o=u._data(u.cookiePrefix+a),!o||!p.persist.overrideSource&&l.activeNode||(k=l.getNodeByKey(o),k&&(k.debug("persist: set active",o),k.setActive(!0,{noFocus:!0})))),u.storeFocus&&v&&(k=l.getNodeByKey(v),k&&(l.options.titlesTabbable?e(k.span).find(".fancytree-title").focus():e(l.$container).focus())),l._triggerTreeEvent("restore",null,{})})}),this._superApply(arguments)},nodeSetActive:function(e,t,o){var i,s=this._local;return t=t!==!1,i=this._superApply(arguments),s.storeActive&&s._data(s.cookiePrefix+a,this.activeNode?this.activeNode.key:null),i},nodeSetExpanded:function(e,t,o){var i,s=e.node,r=this._local;return t=t!==!1,i=this._superApply(arguments),r.storeExpanded&&r._appendKey(n,s.key,t),i},nodeSetFocus:function(e,t){var o,i=this._local;return t=t!==!1,o=this._superApply(arguments),i.storeFocus&&i._data(i.cookiePrefix+d,this.focusNode?this.focusNode.key:null),o},nodeSetSelected:function(e,t){var o,i=(e.tree,e.node),s=this._local;return t=t!==!1,o=this._superApply(arguments),s.storeSelected&&s._appendKey(c,i.key,t),o}})}(jQuery,window,document);