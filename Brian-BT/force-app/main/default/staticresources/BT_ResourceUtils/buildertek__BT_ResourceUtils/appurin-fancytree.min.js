Appurin.namespace("Appurin.tree"),Appurin.tree.createFancyTree=function(e,t){var a="#"+t.renderTo,r={extensions:["persist"],title:"Appurin Tree",rootCollapsible:!1,keyboard:!0,cookie:{expires:null},keyPathSeparator:"/",imagePath:"jquery/images/",checkbox:!1,selectMode:t.selectMode,source:[{title:"Test Node 1",lazy:!1},{title:"Test Node 2",select:!0}],persist:{expandLazy:!0,store:"auto"},activate:function(e,t){onClickTreeNode(t.node,e),Appurin.tree.treeSelectionUpdate(t.node)},select:function(e,t){t.node.setActive(!0),Appurin.tree.treeSelectionUpdate(t.node)},expand:function(e,t){j$(".fancytree-title").easyTooltip({width:"200px",isLightning:!0})},click:function(e,t){},lazyLoad:function(a,d){var o=new j$.Deferred;d.result=o;var n=d.node,i=e+"/"+n.data.userData.key,l=n.data.userData.objectType,c=n.data.userData.nodeType,s=n.data.userData.childObjectType,p=n.data.userData.titleFieldName,u=n.data.userData.nodeQuery,h=n.data.userData.showGroupByCharts,y=n.data.userData.showResultObjectsInTree,T=n.data.userData.showNewButton,f=n.data.userData.tncId;if(n.data.userData.orderChildrenBy+""!="undefined")var N=n.data.userData.orderChildrenBy;else N="";if(n.data.userData.queryParameters+""!="undefined")var A=n.data.userData.queryParameters;else A="{}";buildertek.BT_TreeRemotingModel.getChildren(l,i,"Id,Name",c,s,p,u,h,y,T,f,N,A,t.displayColumnNames,function(e,t){Appurin.tree.setCheckableForChildren(e,r),o.resolve(e)}),j$(".fancytree-title").easyTooltip({width:"200px",isLightning:!0})}};return j$.extend(r,t),r.checkbox&&Appurin.tree.setCheckableForChildren(r.source,r),j$(a).fancytree(r)},Appurin.tree.treeSelectionUpdate=function(e){var t=e.tree.getSelectedNodes(),a=[],r=[];j$.each(t,function(e,t){if(-1==r.indexOf(t.data.userData.key)&&!t.hideCheckbox){var d=t.getParent();"NodeType_GroupBy"!=t.data.userData.nodeType&&"NodeType_GroupByRoot"!=t.data.userData.nodeType&&(d.hideCheckbox&&d.selected||"NodeType_GroupBy"==d.data.userData.nodeType&&d.selected||!d.selected)&&(newNodeTodAdd={},newNodeTodAdd.fullPath=t.getKeyPath(),newNodeTodAdd.id=t.data.userData.key,newNodeTodAdd.objectType=t.data.userData.childObjectType,"AmazonFile"==t.data.userData.objectType||"AmazonFolder"==t.data.userData.objectType?"AmazonFile"==t.data.userData.objectType?newNodeTodAdd.detailUrl="":"AmazonFolder"==t.data.userData.objectType&&(newNodeTodAdd.detailUrl=""):newNodeTodAdd.detailUrl="Group"==t.data.userData.childObjectType?"/setup/own/groupdetail.jsp?id="+t.key:"/"+t.data.userData.key,newNodeTodAdd.icon=t.tree.options.imagePath+t.data.icon,newNodeTodAdd.name=Appurin.tree.getHierarchicalTreeNodePath(t,t.tree.data.NumberOfNodePathLevels),a.push(newNodeTodAdd),r.push(t.data.userData.key))}}),Appurin.tree.getSelectedNodesInformation(e.tree.options.renderTo,a)},Appurin.tree.getHierarchicalTreeNodePath=function(e,t){var a=e.title,r=parseInt(t);for(e=e.getParent();null!=e&&!e.isRoot()&&r>0;){a=e.title+"/"+a,e=e.getParent(),r--}return a},Appurin.tree.getSelectedNodesInformation=function(e,t){var a=j$("div[id$='"+e+"']").parent().parent().find("tbody[id$='treeSelectedRecordsTableBody']");if(void 0==a.html())return!1;j$("div[id$='"+e+"']").parent().parent().parent().find("input[id$='hiddenFieldForSelectedTreeNodesJsonString']").val(JSON.stringify(t)),void 0!=a.find("#treeNoRecordSelectedRow").html()&&(treeNoRecordSelectedRow=a.find("#treeNoRecordSelectedRow").css("display","table-row")),a.html(""),0==t.length?a.append(treeNoRecordSelectedRow):j$.each(t,function(e,t){var r=Appurin.tree.getNodeTitleHTML(t);a.append("<tr><td class=''>"+r+"</td></tr>")})},Appurin.tree.getNodeTitleHTML=function(e){var t="";return""!=e.icon&&""!=e.detailUrl?t=t+"<img src='"+e.icon+"' alt='' class='slds-icon slds-icon--x-small'/> <a href="+e.detailUrl+" class='slds-p-left--xx-small' target='_blank'>"+e.name+"</a>":""==e.icon&&""!=e.detailUrl?t=t+"<a href="+e.detailUrl+" class='slds-p-left--xx-small' target='_blank'>"+e.name+"</a>":""!=e.icon&&""==e.detailUrl&&(t=t+"<img src='"+e.icon+"' alt='' class='slds-icon slds-icon--x-small' />"+e.name),t},Appurin.tree.setCheckableForChildren=function(e,t){checkableNodes=t.checkableNodes,j$.each(e,function(e,a){var r=a.userData.objectType,d=a.userData.childObjectType,o=a.userData.recordType;a.userData.checkable&&Appurin.isDefined(r)&&(-1!=j$.inArray(r,checkableNodes)||-1!=j$.inArray(r+"."+o,checkableNodes)||-1!=j$.inArray(d,checkableNodes)||-1!=j$.inArray(d+"."+o,checkableNodes))?a.hideCheckbox=!1:1!=a.hideCheckbox&&(a.hideCheckbox=!0),null!=a.children&&Appurin.tree.setCheckableForChildren(a.children,t)})},Appurin.tree.activateTreeNode=function(e,t){var a=j$("#"+e).fancytree("getTree");""!=t&&a.loadKeyPath(t,function(e,t){"loaded"==t||"ok"==t&&(e.setExpanded(!0),e.setActive(!0),j$(e.span).click())})},Appurin.tree.setEasyTooltipForChildren=function(e,t){void 0!=e&&j$.each(e,function(e,t){t.tooltip=htmlDecode(t.tooltip),Appurin.tree.setEasyTooltipForChildren(t.children,t)})};