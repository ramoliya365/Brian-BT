<aura:component implements="flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes" access="global" Controller="QuoteDAO">
    <!--<ltng:require styles="{!join(',',$Resource.BTDrag + '/BT-Drag.min.css')}"
                  scripts="{!join(',',$Resource.Jquery + '/jquery/lightning/js/jquery-3.2.1.min.js',$Resource.BTDrag+ '/BT-Drag.min.js')}"
                  afterScriptsLoaded="{!c.initialize}"/>-->
    <aura:attribute name="currencycode" type="String" />
    <aura:attribute name="multicurrency" type="Boolean" />
    <aura:attribute name="productfamily" type="string" />
    <aura:attribute name="Description" type="string" />
    <aura:attribute name="UOMvalues" type="string" />
    <aura:attribute name="quoteGroupName" type="string" default="" />
    <aura:attribute name="quoteGroupNameDescription" type="string" />
    <aura:attribute name="budgetGroupId" type="string" />
    <aura:attribute name="quoteGroupId" type="string" />
    <aura:attribute name="productfamilyoptions" type="List" />
    <aura:attribute name="listofproductfamily" type="List" />
    <aura:handler name="onSelectEvt" event="c:BT_LookupEvent" action="{!c.handleLookUpEvent}" />
    <aura:attribute name="groupFilter" type="string" />
    <aura:attribute name="groupDescription" type="string" default="" />
    <aura:attribute name="deleteRecords" type="list" />
    <aura:attribute name="recordId" type="string" />
    <aura:attribute name="groupDescriptionIndex" type="Integer" />
    <aura:attribute name="isGroupDescriptionOpen" type="Boolean" default="false" />
    <aura:attribute name="isGroupNameOpen" type="Boolean" default="false" />
    <aura:attribute name="changeGroupNameId" type="String" default="" />
    <aura:attribute name="changeGroupName" type="String" default="" />
    <aura:attribute name="groupNameIndex" type="Integer" />
    <aura:attribute name="QuoteInfo" type="Quote__c" default="{ 'sobjectType':'Quote__c'}" access="global" />
    <aura:attribute name="refreshGridAction" type="Aura.Action" default="{!c.refreshQuoteItemList}" />
    <aura:attribute name="newQi" type="Quote_Item__c" default="{ 'sobjectType': 'Quote_Item__c' }" access="public" />
    <aura:attribute name="newQuote" type="Quote_Item__c" default="{ 'sobjectType':'Quote_Item__c',  'buildertek__Quantity__c':1}" access="global" />
    <aura:attribute name="selectedLookUpRecord" type="sObject" default="{}" />
    <aura:attribute name="unitPrice" type="decimal" />
    <!-- <aura:handler event="force:refreshView" action="{!c.isRefreshed}" />-->
    <aura:handler name="onSaveSuccess" event="force:recordSaveSuccess" action="{!c.handleSaveSuccess}" />
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />
    <aura:handler name="render" value="{!this}" action="{!c.onRender}" />
    <aura:handler name="editQuoteItemEvent" event="c:BT_Edit_Quote_Item_Component_Event" action="{!c.eventAction}" />
    <aura:handler event="force:showToast" action="{!c.handleSaveSuccess}" />
    <aura:handler name="destroy" value="{!this}" action="{!c.handleDestroy}" />
    <aura:handler name="cmpEvent" event="c:BT_Edit_Quote_Item_Component_Event" action="{!c.getsetparams}" />
    <!-- <aura:handler event="aura:locationChange" action="{!c.handlelocationchange}" /> -->
    <aura:attribute name="quoteLineID" type="string" access="public" />
    <aura:attribute name="quoteLineID1" type="string" access="public" />
    <aura:attribute name="storePriceBookId" type="List" default="" />
    <aura:attribute name="selectedRows" type="List" default="" />
    <aura:attribute name="NewselectedRows" type="List" />
    <aura:attribute name="selectedCol" type="list" />
    <aura:registerEvent name="oSelectedCheckboxValue" type="c:SelectedCheckboxValue" />
    <aura:attribute name="groupListSize" type="Integer" default="0" description="Section list size" />
    <aura:attribute name="wrapperListLength" type="Integer" />
    <aura:method name="refreshData" action="{!c.doInit}" access="public" />
    <aura:attribute name="headerFields" type="List" default="" description="Quote header fields" />
    <aura:attribute name="quoteByGroupId" type="Map" access="public" default="{}" description="Section details by parent id map" />
    <aura:attribute name="groups" type="List" description="section detail list" />
    <aura:attribute name="initReference" type="Aura.Action" default="{!c.doInit}"  description="Init Reference action used to call from child components" />
    <aura:attribute name="groupLoaded" type="Boolean" default="false"  description="This boolean will be true once all section list loaded through aura itration." />
    <aura:attribute name="save" type="Aura.Action" description="Save action Reference action" />
    <aura:attribute name="columns" type="List" />
    <aura:attribute name="dummyData" type="List" />
    <aura:registerEvent name="ClearSelectedRecordEvent" type="c:BT_CLearLightningLookupEvent" />
    <aura:handler name="RefreshEvent" event="c:BT_RefreshEvent" action="{!c.handleEvent}" />
    <aura:handler name="oSelectedRecordEvent" event="c:BT_LightningLookupEvent" action="{!c.handleComponentEvent}" />
    <aura:attribute name="productId" type="string" />
    <aura:attribute name="productName" type="string" />
    <aura:attribute name="options" type="List" />
    <aura:attribute name="costCode" type="string" />
    <aura:attribute name="costCodeFilter" type="string" />
    <aura:attribute name="record" type="Object" />
    <aura:attribute name="Spinner" type="boolean" default="false" />
    <aura:attribute name="Spinner2" type="boolean" default="false" />
    <aura:attribute name="Spinner22" type="boolean" default="false" />
    <aura:attribute name="InnerList" type="Object" />
    <aura:attribute name="isSelectAll" type="boolean" default="false" />
    <aura:attribute name="summaryColumns" type="List" />
    <aura:attribute name="Table_header_Records" type="object" access="global" />
    <aura:attribute name="TotalRecords" type="object" access="global" />
    <aura:attribute name="isOpen" type="boolean" default="false" />
    <aura:attribute name="quoteItemId" type="String" />
    <aura:attribute name="isEditMode" type="boolean" default="false" />
    <aura:attribute name="fieldName" type="String" />
    <aura:attribute name="datalist" type="list" />
    <aura:attribute name="priorityOption" type="List" />
    <aura:attribute name="editedGroupId" type="String" />
    <aura:attribute name="pricebookoptions" type="List" />
    <aura:attribute name="pricebookName" type="string" />
    <aura:attribute name="pricebookName1" type="string" />
    <aura:attribute name="QuoteString" type="String" />
    <aura:attribute name="showButtons" type="boolean" default="false" />
    <aura:attribute name="finalString" type="object" />
    <aura:attribute name="quoteItemList" type="Quote_Item__c[]" />
    <aura:attribute name="quoteName" type="String" default="" />
    <aura:attribute name="quoteId" type="String" />
    <aura:attribute name="isproject" type="Boolean" default="false" />
    <aura:attribute name="editUnitPrice" type="Boolean" default="false" />
    <aura:attribute name="editedquoterec" type="String" />
    <aura:attribute name="markup" type="decimal" default="" />
    <aura:attribute name="isunitcost" type="decimal" default="" />
    <aura:attribute name="isdiscount" type="decimal" default="" />
    <aura:attribute name="isSalesprice" type="decimal" default="" />
    <aura:attribute name="NetUnit" type="decimal" default="" />
    <aura:attribute name="listPrice" type="decimal" default="" />
    <aura:attribute name="mapDistances" type="Map" default="{}" />
    <aura:attribute name="searchKey2" type="string" />
    <aura:attribute name="clickRejectBtn" type="Boolean" default="false" />

    <aura:attribute name="unitCost" type="currency" default="0" />

    <!-- <aura:attribute name="getRejectQuoteLine" type="Quote_Item__c[]" />-->

    <!-- <aura:attribute name="rejectData" type="Object" /> -->
    <!-- <aura:attribute name="rejectColumns" type="List" /> -->




    <!-- refresh component event -->
    <aura:handler event="force:refreshView" action="{!c.refreshComponentHandler}" />

    <!-- MassUpdate start -->
    <aura:attribute name="enableMassUpdate" type="boolean" default="false" />
    <aura:attribute name="selectedMassLookUpRecord" type="sObject" default="{}" />
    <aura:attribute name="newMassQuote" type="Quote_Item__c" default="{ 'sobjectType':'Quote_Item__c'}"   access="global" />
    <aura:attribute name="newMassQi" type="Quote_Item__c" access="public" />
    <aura:attribute name="duplicateRecs" type="List" default="[]" />
    <aura:attribute name="isDuplicate" type="Boolean" default="false" />
    <aura:attribute name="isMassDuplicate" type="Boolean" default="false" />
    <aura:attribute name="isChangeData" type="Boolean" default="false" />
    <aura:attribute name="isMarkup" type="Boolean" default="false" />
    <aura:attribute name="isMargin" type="Boolean" default="false" />
    <aura:attribute name="QuoteRec" type="Quote__c" default="{ 'sobjectType':'Quote__c','buildertek__Markup__c':'0'}"  access="global" />
    <aura:attribute name="QuoteMargin" type="Integer" default="" />
    <aura:attribute name="isQuoteRecChange" type="Boolean" default="false" />
    <aura:attribute name="currentId" type="String" default="" />

    <aura:attribute name="isQuotelinedelete" type="Boolean" default="false" />
    <aura:attribute name="QuotelinePopupHeader" type="String" default="" />
    <aura:attribute name="QuotelinePopupDescription" type="String" default="" />


    <aura:attribute name="PopupHeader" type="String" default="" />
    <aura:attribute name="PopupDescription" type="String" default="" />
    <aura:attribute name="isAddProductFromGroup" type="Boolean" default="false" />
    <aura:attribute name="addGroupPopup" type="Boolean" default="false" />
    <aura:attribute name="currentTab" type="String" default="" />
    <aura:attribute name="runFirstTime" type="Boolean" default="false" />
    <aura:attribute name="removeSingleQuoteLineOption" type="Boolean" default="false" />
    <aura:attribute name="hideGlobalMargin" type="Boolean" default="false" />
    <aura:attribute name="hideGlobalMarkup" type="Boolean" default="false" />

    <aura:attribute name="hideMargin" type="Boolean" default="false" />
    <aura:attribute name="hideMarkup" type="Boolean" default="false" />

    <aura:attribute type="Map" name="checkboxState" />


    <lightning:workspaceAPI aura:id="workspace" />

    <!-- MassUpdate End -->

    <!-- Pagination Start -->


    <aura:attribute name="page" type="integer" description="using for store page Number" />
    <aura:attribute name="pages" type="integer" description="using for store All Pages page Number" />
    <aura:attribute name="total" type="integer" description="total records count store " />

    <!-- Pagination End -->
    <aura:attribute name="openProductBox" type="Boolean" default="false" />
    <aura:attribute name="columns1" type="List" />
    <aura:attribute name="data1" type="Object" />
    <aura:attribute name="listOfSelectedIds" type="List" default="[]" />
    <aura:attribute name="openQuoteLineBox" type="Boolean" default="false" />
    <aura:attribute name="data2" type="Object" />
    <aura:attribute name="filteredData" type="Map" />
    <aura:attribute name="QuoteLineList" type="List" />
    <aura:attribute name="quotelineRecords" type="Object" />
    <aura:attribute name="selectedValue" type="String" />
    <aura:attribute name="StoreIdsOfDatatable" type="List" />
    <aura:attribute name="StoreIdsOfDatatable2" type="List" />
    <aura:attribute name="oldData" type="List" default="[]" />
    <aura:attribute name="sortedBy" type="String" default="Family" />
    <aura:attribute name="sortedDirection" type="String" default="asc" />
    <aura:attribute name="isDisabled" type="Boolean" default="false" />
    <aura:attribute name="checkFunctionCall" type="Boolean" default="false" />

    <aura:attribute name="isBOMmodalOpen" type="boolean" default="false" />
    <aura:attribute name="GroupingOptions" type="List" />
    <aura:attribute name="valueofField1" type="string" />
    <aura:attribute name="valueofField2" type="string" />
    <aura:attribute name="valueofField3" type="string" />
    <aura:attribute name="valueofField4" type="string" />

    <!-- BOM Grouping Attribute -->
    <aura:attribute name="displayGrouping" type="Boolean" default="false" />
    <aura:attribute name="groupFieldList" type="List" />
    <aura:attribute name="QuoteLineWrapper" type="Object" />
    <aura:attribute name="totalColumn" type="Integer" />
    <aura:attribute name="firstGrouping" type="Boolean" default="false" />
    <aura:attribute name="secondGrouping" type="Boolean" default="false" />
    <aura:attribute name="thirdGrouping" type="Boolean" default="false" />
    <aura:attribute name="forthGrouping" type="Boolean" default="false" />
    <aura:attribute name="TotalRecordCount" type="Integer" default="0" />
    <aura:attribute name="CollapeCount" type="Integer" default="0" />
    <aura:attribute name="displayRecordList" type="List" />

    <aura:method name="refreshComponent" action="{!c.doInit}" />

    <aura:attribute name="quoteNameData" type="Object" />
    <aura:handler name="change" value="{!v.quoteNameData}" action="{!c.setTabName}"/>
    <force:recordData aura:id="recordLoader" recordId="{!v.recordId}" fields="Name" targetFields="{!v.quoteNameData}" />
    <!-- Handler -->

    <aura:handler name="change" value="{!v.groupLoaded}" action="{!c.groupLoaded}" />
    <aura:attribute name="parentAttribute" type="Boolean" default="false" />
    <c:BT_Spinner />



    <div style="background: white;border-radius: 5px;height: 100%;" class="slds">



        <div class="slds-modal__header" style="font-size:17px;">
            <aura:if isTrue="{!v.isproject}">
                <a href="{!'/'+v.quoteId}" onclick="{!c.closetab}">{!v.quoteName}</a>
                <span style="float:right; font-size: small;">
                    <lightning:button variant="neutral" label="Cancel" title="Cancel" onclick="{!c.closetab}"
                        iconPosition="right" />
                </span>

            </aura:if>
        </div>

        <div style="margin: -8px 0px;">
            <div style="display:block">
                <aura:if isTrue="{!!v.displayGrouping}">
                    <div id='collapseBtn' class="slds-float_left" style="margin-top: 5px;">
                        <span style="display:none;margin-left:1.6rem" class="{!'expandAllBtn_'+v.quoteId}"
                            data-iconattr="{!'expandAllBtn_'+v.quoteId}" data-iconname="Expand All"
                            onclick="{!c.expandCollapeAll}">
                            <lightning:buttonIcon aura:id="expandCollapeseAllBtn" iconName="utility:add"
                                variant="border-filled" iconClass="dark" alternativeText="Expand All"
                                title="Expand All" />
                        </span>
                        <span style="display:inline-block;margin-left:1.6rem" class="{!'CollapeseAllBtn_'+v.quoteId}"
                            data-iconattr="{!'CollapeseAllBtn_'+v.quoteId}" data-iconname="Collapse All"
                            onclick="{!c.expandCollapeAll}">
                            <lightning:buttonIcon aura:id="expandCollapeseAllBtn2" iconName="utility:dash"
                                variant="border-filled" iconClass="dark" alternativeText="Collapse All"
                                title="Collapse All" />
                        </span>
                    </div>
                    <aura:set attribute="else">
                        <div id='collapseBtn' class="slds-float_left" style="display:flex">
                            <aura:if isTrue="{!v.firstGrouping}">
                                <div style="padding-left: 10px;"></div>
                            </aura:if>
                            <aura:if isTrue="{!v.secondGrouping}">
                                <div style="padding-left: 10px;"></div>
                            </aura:if>
                            <aura:if isTrue="{!v.thirdGrouping}">
                                <div style="padding-left: 40px;"></div>
                            </aura:if>
                            <aura:if isTrue="{!v.forthGrouping}">
                                <div style="padding-left: 70px;"></div>
                            </aura:if>
                            <span data-iconname="Expand All" id="{!'expandAllBtn_'+v.recordId}"
                                onclick="{!c.expandCollapeAllBom}" style="display:none">
                                <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark"
                                    alternativeText="Expand All" title="Expand All" />
                            </span>
                            <span data-iconname="Collapse All" id="{!'collapeseAllBtn_'+v.recordId}"
                                onclick="{!c.expandCollapeAllBom}" style="display:inline-block;">
                                <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark"
                                    alternativeText="Collapse All" title="Collapse All" />
                            </span>
                        </div>
                    </aura:set>
                </aura:if>
                <div id='btnDiv' style="display:flex; justify-content: right; margin-top: 30px;"
                    class="slds-m-top_medium slds-m-right_small">
                    <lightning:buttonGroup>


                        <aura:if isTrue="{!!v.hideGlobalMargin}">
                            <div class="slds-truncate" title="test1" style="padding: 10px 0px 0px 10px; width:110px;">
                                Global Margin</div>
                            <ui:inputNumber aura:id="testId" value="{!v.QuoteMargin}" class="uiInputCss">
                            </ui:inputNumber>
                            <lightning:buttonIcon iconName="utility:save" class="saveInputCss slds-m-left_xx-small"
                                onclick="{!c.onMarginChange}" alternativeText="Save" />
                        </aura:if>
                        <aura:if isTrue="{!!v.hideGlobalMarkup}">
                            <div class="slds-truncate" title="test1" style="padding: 10px 0px 0px 10px; width:110px;">
                                Global Markup</div>
                            <ui:inputNumber aura:id="testId" value="{!v.QuoteRec.buildertek__Markup__c}"
                                class="uiInputCss">
                            </ui:inputNumber>
                            <lightning:buttonIcon iconName="utility:save" class="saveInputCss slds-m-left_xx-small"
                                onclick="{!c.onMarkupChange}" alternativeText="Save" />
                        </aura:if>

                        <aura:if isTrue="{!v.enableMassUpdate}">
                            <div>
                                <lightning:button iconName="utility:save" iconPosition="left"
                                    onclick="{!c.onClickMassUpdate}"
                                    label="{!v.enableMassUpdate==true?'Save':'Mass Update'}" class="sldsButtonGroup" />
                            </div>&nbsp;
                            <div>
                                <lightning:button iconName="utility:close" iconPosition="left"
                                    onclick="{!c.onClickMassUpdateCancel}" label="Cancel" class="sldsButtonGroup" />
                            </div>
                            <aura:set attribute="else">
                                <div>
                                    <lightning:button iconPosition="left" onclick="{!c.addProductFromGroup}"
                                        label="Add Products" class="sldsButtonGroup" />
                                </div>&nbsp;

                                <div>
                                    <lightning:button aura:id='rejectBtn' disabled="true" iconPosition="left"
                                        label="Rejected Lines" class="sldsButtonGroup"
                                        onclick="{!c.clickRejectLinesBtn}" />
                                </div>&nbsp;


                                <div>
                                <lightning:button iconPosition="left" onclick="{!c.onClickAddlines}" label="Mass Add Line" class="sldsButtonGroup" />
                            </div>&nbsp;

                                <div>
                                    <aura:if isTrue="{!!v.displayGrouping}">
                                        <lightning:button iconPosition="left" onclick="{!c.onclickBOMGrouping}" label="Group" class="sldsButtonGroup" />
                                        <aura:set attribute="else">
                                            <lightning:button iconPosition="left" onclick="{!c.returnToNormalVIew}" label="Return" class="sldsButtonGroup" />
                                        </aura:set>
                                    </aura:if>
                                </div>&nbsp;

                                <div>
                                    <lightning:button iconName="utility:edit" iconPosition="left"
                                        onclick="{!c.onClickMassUpdate}"
                                        label="{!v.enableMassUpdate==true?'Save':'Mass Update'}"
                                        class="sldsButtonGroup" />
                                </div>&nbsp;

                                <!-- <lightning:button iconName="utility:groups" iconPosition="left"
                            onclick="{!c.onClickCreateNewGroup}" label="Add Group" class="sldsButtonGroup" />-->
                                <!-- <div>
                                    <lightning:button iconName="utility:copy" iconPosition="left"
                                        onclick="{!c.onClickMassDuplicate}" label="Duplicate Lines"
                                        class="sldsButtonGroup" />
                                </div>&nbsp; -->

                                <!-- <lightning:button label="Add Product" onclick="{!c.addProduct}" class="sldsButtonGroup" />-->
                                <div>
                                    <lightning:button label="Import RFQ's" onclick="{!c.addRFQ}"
                                        class="sldsButtonGroup" />
                                </div>&nbsp;
                                <div style="border-radius: 0.25rem;">
                                    <lightning:button label="Delete" onclick="{!c.deleteSelectedQuoteItem}"
                                        class="sldsButtonGroup" />
                                </div>

                            </aura:set>
                        </aura:if>
                    </lightning:buttonGroup>
                </div>
            </div>
            <br />
            <!-- <div id='collapseBtn' class="slds-float_left" style="padding: 0.5rem; margin-top: -5px;display:contents">
            <span style="display:none;" class="{!'expandAllBtn_'+v.quoteId}" data-iconattr="{!'expandAllBtn_'+v.quoteId}" data-iconname="Expand All" onclick="{!c.expandCollapeAll}">
                <lightning:buttonIcon aura:id="expandCollapeseAllBtn" iconName="utility:add" variant="border-filled"
                    iconClass="dark" alternativeText="Expand All" title="Expand All" />
            </span>
            <span style="display:inline-block;" class="{!'CollapeseAllBtn_'+v.quoteId}" data-iconattr="{!'CollapeseAllBtn_'+v.quoteId}" data-iconname="Collapse All" onclick="{!c.expandCollapeAll}">
                <lightning:buttonIcon aura:id="expandCollapeseAllBtn2" iconName="utility:dash"
                    variant="border-filled" iconClass="dark" alternativeText="Collapse All" title="Collapse All" />
            </span>
        </div> -->
            <aura:if isTrue="{!v.addGroupPopup}">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                    aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close" onclick="{! c.newGroupCloseModal }"
                                alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                            <h2 id="modal-heading-01" class="slds-text-heading_large slds-hyphenate">Add Quote Line
                                Group
                            </h2>
                        </header>
                        <div class="slds-modal__content slds-p-around_large" id="modal-content-id-222">
                            <lightning:layout multipleRows="true">
                                <lightning:layoutItem size="12" mediumDeviceSize="6" padding="around-small">
                                    <lightning:input type="textarea" aura:id="gpnameid" value="{!v.quoteGroupName}"
                                        label="Name" />
                                </lightning:layoutItem>

                                <lightning:layoutItem size="12" mediumDeviceSize="6" padding="around-small">
                                    <lightning:textarea aura:id="gpdescid" value="{!v.quoteGroupNameDescription}"
                                        label="Description" />
                                </lightning:layoutItem>
                            </lightning:layout>
                        </div>
                        <footer class="slds-modal__footer">
                            <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                onclick="{!c.newGroupCloseModal}" />
                            <lightning:button variant="brand" label="Save" title="Save"
                                onclick="{!c.createNewQuoteLineGroup}" />
                        </footer>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </aura:if>

            <aura:if isTrue="{!v.isAddProductFromGroup}">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                    aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeAddProductFromGroup }"
                                alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                            <h2 id="modal-heading-01" class="slds-text-heading_large slds-hyphenate">Add Quote Line</h2>
                        </header>
                        <div class="slds-modal__content" id="modal-content-id-1">
                            <div class="slds-p-around_large">
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_6-of-12">
                                        <label class="slds-form-element__label">Pricebook</label>
                                        <ui:inputSelect value="{!v.pricebookName}" change="{!c.changeEvent}"
                                            class="pricebook-class">
                                            <aura:iteration var="option" items="{! v.pricebookoptions }">
                                                <option value="{! option.value }"
                                                    selected="{!option.value == v.pricebookName}">
                                                    {! option.key }
                                                </option>
                                            </aura:iteration>
                                        </ui:inputSelect>
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                        <lightning:input value="{!v.newQuote.buildertek__Markup__c}" label="Markup"
                                            aura:id="markUpId" type="number" step="0.01" />
                                    </div>
                                </div>
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_6-of-12">
                                        <label class="slds-form-element__label">Product Family</label>
                                        <ui:inputSelect value="{!v.productfamily}" change="{!c.changefamily}"
                                            class="pricebook-class">
                                            <aura:iteration var="option" items="{!v.listofproductfamily}">
                                                <option value="{!option.productfamilyvalues}"
                                                    selected="{!option.productfamilyvalues == v.productfamily}">
                                                    {!option.productfamilyvalues}</option>
                                            </aura:iteration>
                                        </ui:inputSelect>
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                        <lightning:input type="text" label="Description"
                                            value="{!v.newQuote.buildertek__Description__c}" required="true"
                                            style="max-width: 100% !important;" />
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                        <ui:inputTextArea value="{!v.newQuote.buildertek__Notes__c}" />
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                        <label class="slds-form-element__label">Grouping</label>
                                        <c:BT_LookupFields aura:id="groupId" fieldName="buildertek__Grouping__c"
                                            childObjectName="buildertek__Quote_Item__c"
                                            recordId="{!v.newQuote.buildertek__Grouping__c}" />
                                    </div>
                                </div>
                                
                                <div class="slds-grid slds-gutters">

                                    <div class="slds-col slds-size_6-of-12">
                                        <label class="slds-form-element__label">Product</label>
                                        <c:BT_LightningLookup objectAPIName="Product2" IconName="standard:product"
                                            selectedRecord="{!v.selectedLookUpRecord}" aura:id="productId"
                                            parentId="{! v.pricebookName }" prodctfamly="{!v.productfamily}" />
                                    </div>

                                    <div class="slds-col slds-size_6-of-12">
                                        <label class="slds-form-element__label">UOM</label>
                                        <br />
                                        <ui:inputSelect value="{! v.UOMvalues }" class="pricebook-class"
                                            aura:id="uomId">
                                            <aura:iteration var="option" items="{! v.options }">
                                                <option value="{! option.value }"
                                                    selected="{!option.value == v.UOMvalues}">{! option.label }</option>
                                            </aura:iteration>
                                        </ui:inputSelect>
                                    </div>
                                </div>
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_6-of-12">
                                        <!-- <label class="slds-form-element__label">Quote Line</label>
                            <ui:inputText value="{!v.newQuote.Name}" aura:id="quoteLineID" required = "true"/> -->
                                        <lightning:input type="text" label="Quote Line" value="{!v.newQuote.Name}"
                                            aura:id="quoteLineID" required="true" />
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                    </div>
                                </div>
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_6-of-12">
                                        <label class="slds-form-element__label">Quantity</label>
                                        <ui:inputNumber value="{!v.newQuote.buildertek__Quantity__c}" />
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                    </div>
                                </div>
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_6-of-12">
                                        <lightning:input type="Currency" label="Unit Cost"
                                            value="{!v.newQuote.buildertek__Unit_Cost__c}" aura:id="unitCostId"
                                            required="true" />
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                    </div>
                                </div>
                                <div class="slds-grid slds-gutters">
                                    <div class="slds-col slds-size_6-of-12">
                                        <label class="slds-form-element__label">List Price</label>
                                        <ui:inputCurrency value="{!v.newQuote.buildertek__Unit_Price__c}"
                                            aura:id="listpriceId" />
                                    </div>
                                    <div class="slds-col slds-size_6-of-12">
                                    </div>
                                </div>
                                <br />
                                <br />
                            </div>
                            <aura:if isTrue="{!v.Spinner}">
                                <div aura:id="spinnerId" class="slds-spinner_container">
                                    <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative"
                                        role="alert">
                                        <span class="slds-assistive-text">Loading</span>
                                        <div class="slds-spinner__dot-a"></div>
                                        <div class="slds-spinner__dot-b"></div>
                                        <!--  <div class="custom-loading-text">
                    <b>Processing, Please Wait</b>
                </div> -->
                                    </div>
                                </div>
                            </aura:if>
                            <!-- <div class="slds-m-top_medium">
                <div class="slds-docked-form-footer slds-modal__footer customFooter" style="height:10vh;">
                    <div style="float:right;">
                        <lightning:button variant="neutral" label="Cancel" title="Cancel"
                            onclick="{! c.closeAddProductFromGroup }" />
                        <lightning:button variant="brand" label="Adde &amp; New" title="Save &amp; New"
                            onclick="{!c.saveAndNew}" />
                        <lightning:button variant="brand" label="Add" title="Add"
                            onclick="{!c.addProductFromGroup}" />
                    </div>
                </div>          
            </div>-->
                            <footer class="slds-modal__footer">
                                <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                    onclick="{! c.closeAddProductFromGroup }" />
                                <lightning:button variant="brand" label="Add &amp; New" title="Save &amp; New"
                                    onclick="{!c.saveAndNew}" />
                                <lightning:button variant="brand" label="Add" title="Add"
                                    onclick="{!c.addProductFromGroup}" />


                            </footer>
                            <!-- <div class="slds-modal__footer" style="height:10vh; width:105% ">
                        <lightning:button variant="neutral" label="Cancel" title="Cancel"
                            onclick="{! c.closeAddProductFromGroup }" />
                        <lightning:button variant="brand" label="Adde &amp; New" title="Save &amp; New"
                            onclick="{!c.saveAndNew}" />
                        <lightning:button variant="brand" label="Add" title="Add"
                            onclick="{!c.addProductFromGroup}" />
                        
                        
                    </div>-->

                        </div>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </aura:if>

            <aura:if isTrue="{!v.isGroupNameOpen}">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                    aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeGroupName }"
                                alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                            <h2 id="modal-heading-01" class="slds-text-heading_large slds-hyphenate">Quote Line Group
                                Name
                            </h2>
                        </header>
                        <div class="slds-modal__content slds-p-around_large" id="modal-content-id-1">
                            <lightning:input variant="bottom-toolbar" value="{!v.changeGroupName}"
                                placeholder="Add Group Name" />
                            <br />
                            <br />
                            <footer class="slds-modal__footer">
                                <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                    onclick="{! c.closeGroupName }" />
                                <lightning:button variant="brand" label="Update" title="Update"
                                    onclick="{!c.onClickChangeGroupName}" />
                            </footer>
                        </div>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </aura:if>

            <aura:if isTrue="{!v.isGroupDescriptionOpen}">
                <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                    aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                    <div class="slds-modal__container">
                        <header class="slds-modal__header">
                            <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeGroupDescription }"
                                alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                            <h2 id="modal-heading-01" class="slds-text-heading_large slds-hyphenate">Quote Line Group
                                Description
                            </h2>
                        </header>
                        <div class="slds-modal__content slds-p-around_large" id="modal-content-id-1">
                            <lightning:inputRichText variant="bottom-toolbar" value="{!v.groupDescription}"
                                placeholder="Add Group Description" />
                            <br />
                            <br />
                            <footer class="slds-modal__footer">
                                <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                    onclick="{! c.closeGroupDescription }" />
                                <lightning:button variant="brand" label="Add" title="Add"
                                    onclick="{!c.addGroupDescription}" />
                            </footer>
                        </div>
                    </div>
                </section>
                <div class="slds-backdrop slds-backdrop_open"></div>
            </aura:if>

            <div aura:id="quoteItem" />
            <!-- <div class="av slds-box" id="{!v.recordId + 'groups'}" style="min-height:50vh;padding:0px !important;"> -->
            <div class="av slds-box" id="{!v.recordId + 'groups'}" style="min-height:55vh;padding:0px !important;">
                <div>
                    <aura:if isTrue="{!!v.removeSingleQuoteLineOption}">
                        <div id='Tablebox' style="padding:10px;margin-top: -5px;">
                            <br />
                            <div aura:id="inlineEditQuote" style="margin-bottom:18px;">
                                <table class="slds-table slds-table_bordered slds-table_cell-buffer"
                                    style="border:1px solid grey;border-radius: 5px;">
                                    <thead style="border:1px solid rgb(216, 237, 255);">
                                        <tr class="slds-text-title_caps">
                                            <th scope="col" style="background-color:rgba(27, 82, 151, 1.0); color:white; border-top-left-radius:5px; width:13%">
                                                <div class="slds-truncate" title="Pricebook">Pricebook</div>
                                            </th>
                                            <th scope="col" style="background-color:rgba(27, 82, 151, 1.0); color:white; ">
                                                <div class="slds-truncate" title="Product Family">Product Family</div>
                                            </th>
                                            <th scope="col" style="background-color:rgba(27, 82, 151, 1.0); color:white; width:20%;">
                                                <div class="slds-truncate" title="Product">Product</div>
                                            </th>
                                            <th style="background-color:rgba(27, 82, 151, 1.0); color:white; ">
                                                <div class="slds-truncate" title="Description">Description</div>
                                            </th>
                                            <th scope="col" style="background-color:rgba(27, 82, 151, 1.0); color:white;  ">
                                                <div class="slds-truncate" title="Grouping">Grouping</div>
                                            </th>
                                            <th scope="col" style="background-color:rgba(27, 82, 151, 1.0); color:white; ">
                                                <div class="slds-truncate" title="note">Notes</div>
                                            </th>
                                            <th scope="col" style="background-color:rgba(27, 82, 151, 1.0); color:white;">
                                                <div class="slds-truncate" title="Quantity">Quantity</div>
                                            </th>
                                            <th style="background-color:rgba(27, 82, 151, 1.0); color:white;">
                                                <div class="slds-truncate" title="Unit Price">Unit Cost</div>
                                            </th>
                                            <aura:if isTrue="{!!v.hideGlobalMargin}">
                                            <th style="background-color:rgba(27, 82, 151, 1.0); color:white;">
                                                <div class="slds-truncate" title="Mark Up">Margin</div>
                                            </th>
                                            </aura:if>
                                            <aura:if isTrue="{!!v.hideGlobalMarkup}">
                                            <th style="background-color:rgba(27, 82, 151, 1.0); color:white;">
                                                <div class="slds-truncate" title="Mark Up">Markup</div>
                                            </th>
                                            </aura:if>
                                            <th scope="col"
                                                style="background-color:rgba(27, 82, 151, 1.0); color:white; border-top-right-radius:5px; ">
                                                <div class="slds-truncate" title="save">Save</div>
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="tableRow">
                                            <td style="width:13%">
                                                <ui:inputSelect value="{! v.pricebookName }" change="{!c.changeEvent}"
                                                    class="pricebook-class">
                                                    <aura:iteration var="option" items="{! v.pricebookoptions }">
                                                        <option value="{! option.value }"
                                                            selected="{!option.value == v.pricebookName}">{! option.key
                                                            }
                                                        </option>
                                                    </aura:iteration>
                                                </ui:inputSelect>
                                            </td>
                                            <td>
                                                <ui:inputSelect value="{!v.productfamily}" change="{!c.changefamily}"
                                                    class="pricebook-class">
                                                    <option value="--None--" id="noneValue">--None--</option>
                                                    <aura:iteration var="option" items="{!v.listofproductfamily}">
                                                        <option value="{!option.productfamilyvalues}"
                                                            selected="{!option.productfamilyvalues == v.productfamily}">
                                                            {!option.productfamilyvalues}</option>
                                                    </aura:iteration>
                                                </ui:inputSelect>
                                            </td>
                                            <td style="width:20%;">
                                                <aura:html tag="style">
                                                    .mainDiv{
                                                        padding-top:0% !important;

                                                    }
                                                    .pillSize{

                                                        padding-top: 2% !important;
                                                        padding-bottom: 2% !important;
                                                    }
                                                    .subDiv{
                                                        width:100% !important;
                                                    }
                                                </aura:html>
                                                <c:BT_LightningLookup objectAPIName="Product2"
                                                    IconName="standard:product"
                                                    selectedRecord="{!v.selectedLookUpRecord}" aura:id="productId"
                                                    parentId="{! v.pricebookName }" prodctfamly="{!v.productfamily}" />
                                            </td>
                                            <!-- <td>
                                            <ui:inputText value="{!v.newQuote.Name}" aura:id="quoteLineID" />
                                        </td> -->
                                            <td>
                                                <!-- <aura:if isTrue="{!v.newQuote.Name != ''}"> -->
                                                <ui:inputText value="{!v.newQuote.Name}" aura:id="quoteLineID1" />

                                            </td>
                                            <td>
                                                <aura:html tag="style">
                                                    .slds-lookup__menu{
                                                    width: 100% !important;
                                                    height: 200px !important;
                                                    }

                                                    .slds-lookup__list{
                                                    width: auto !important;
                                                    height: 190px !important;
                                                    }
                                                </aura:html>
                                                <c:BT_LookUp aura:id="groupId" _field="buildertek__Grouping__c"
                                                    _sobject="buildertek__Quote_Item__c"
                                                    _value="{!v.newQuote.buildertek__Grouping__c}"
                                                    _text_value="{!v.newQuote.buildertek__Grouping__r.Name}"  _label=""
                                                    _filter="" />
                                            </td>

                                            <!-- <td>
                                            <ui:inputSelect value="{! v.newQuote.buildertek__UOM__c }" class="select-class">
                                                <aura:iteration var="option" items="{! v.options }">
                                                    <option value="{! option.value }">{! option.label }</option>
                                                </aura:iteration>
                                            </ui:inputSelect>
                                        </td> -->
                                            <td>
                                                <ui:inputTextArea value="{!v.newQuote.buildertek__Notes__c}" />
                                            </td>
                                            <td style="width: 6% !important;">
                                                <ui:inputNumber value="{!v.newQuote.buildertek__Quantity__c}" />
                                            </td>
                                            <td style="width: 6% !important;">
                                                <!-- <ui:inputCurrency value="{!v.unitCost}" aura:id="unitCostId" /> -->
                                                <ui:inputCurrency value="{!v.newQuote.buildertek__Unit_Cost__c}"
                                                    aura:id="unitCostId" />
                                            </td>

                                            <aura:if isTrue="{!!v.hideGlobalMargin}">
                                            <td style="padding-bottom:22px; width: 7% !important;">
                                                <lightning:input type="number" name="input7" label="" value="{!v.newQuote.buildertek__Margin__c}" formatter="percent-fixed" aura:id="marginId"  step="0.01"/>
                                            </td>
                                            </aura:if>
                                            <aura:if isTrue="{!!v.hideGlobalMarkup}">
                                            <td style="padding-bottom:22px; width: 7% !important;">
                                                <lightning:input type="number" name="input6" label="" value="{!v.newQuote.buildertek__Markup__c}"  aura:id="markUpId"  formatter="percent-fixed" step="0.01" />
                                            </td>
                                            </aura:if>
                                            

                                            <td>
                                                <lightning:buttonIcon iconName="utility:save" alternativeText="save"
                                                    onclick="{!c.saveQuoteRecord}" />
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </aura:if>

                    <aura:if isTrue="{!or(or(or(v.isDuplicate,v.isMassDuplicate),v.isOpen),v.isQuoteRecChange)}">
                        <div class="slds-m-around_xx-large">
                            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                                aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                                <div class="slds-modal__container">
                                    <header class="slds-modal__header">
                                        <aura:if isTrue="{!v.isOpen}">
                                            <lightning:buttonIcon iconName="utility:close" onclick="{!c.closeModel}"
                                                alternativeText="close" variant="bare-inverse"
                                                class="slds-modal__close" />
                                        </aura:if>
                                        <aura:if isTrue="{!or(v.isDuplicate,v.isMassDuplicate)}">
                                            <lightning:buttonIcon iconName="utility:close"
                                                onclick="{!c.closeDuplicateModel}" alternativeText="close"
                                                variant="bare-inverse" class="slds-modal__close" />
                                        </aura:if>

                                        <aura:if isTrue="{!v.isQuoteRecChange}">
                                            <lightning:buttonIcon iconName="utility:close"
                                                onclick="{!c.closeModelQuoteRec}" alternativeText="close"
                                                variant="bare-inverse" class="slds-modal__close" />
                                        </aura:if>
                                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
                                            {!v.PopupHeader}</h2>
                                    </header>
                                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                                        <center>
                                            <h2>{!v.PopupDescription}</h2>
                                        </center>
                                    </div>
                                    <footer class="slds-modal__footer">
                                        <aura:if isTrue="{!v.isOpen}">
                                            <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                                onclick="{!c.closeModel}" />
                                            <lightning:button variant="brand" label="Delete" title="Delete"
                                                onclick="{!c.deleteQuoteItems}" />
                                        </aura:if>

                                        <aura:if isTrue="{!or(v.isDuplicate,v.isMassDuplicate)}">
                                            <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                                onclick="{!c.closeDuplicateModel}" />
                                        </aura:if>

                                        <aura:if isTrue="{!v.isDuplicate}">
                                            <lightning:button variant="brand" label="Duplicate" title="Duplicate"
                                                onclick="{!c.duplicateQuote}" />
                                        </aura:if>
                                        <aura:if isTrue="{!v.isMassDuplicate}">
                                            <lightning:button variant="brand" label="Duplicate" title="Duplicate"
                                                onclick="{!c.onMassDuplicate}" />
                                        </aura:if>
                                        <aura:if isTrue="{!v.isQuoteRecChange}">
                                            <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                                onclick="{!c.closeModelQuoteRec}" />
                                            <lightning:button variant="brand" label="Save" title="Save"
                                                onclick="{!c.saveQuoteSingleRecord}" />
                                        </aura:if>
                                    </footer>
                                </div>
                            </section>
                            <div class="slds-backdrop slds-backdrop_open"></div>
                        </div>
                    </aura:if>

                    <aura:if isTrue="{!v.isQuotelinedelete}">
                        <div class="slds-m-around_xx-large">
                            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                                aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                                <aura:if isTrue="{!v.Spinner22}">
                                    <div aura:id="spinnerId" class="slds-spinner_container">
                                        <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative"
                                            role="alert">
                                            <span class="slds-assistive-text">Loading</span>
                                            <div class="slds-spinner__dot-a"></div>
                                            <div class="slds-spinner__dot-b"></div>
                                            <div class="custom-loading-text">
                                                <b>Processing, Please Wait</b>
                                            </div>
                                        </div>
                                    </div>
                                </aura:if>
                                <div class="slds-modal__container">
                                    <header class="slds-modal__header">
                                        <aura:if isTrue="{!v.isQuotelinedelete}">
                                            <lightning:buttonIcon iconName="utility:close"
                                                onclick="{!c.closeQuotelineModel}" alternativeText="close"
                                                variant="bare-inverse" class="slds-modal__close" />
                                        </aura:if>
                                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">
                                            {!v.QuotelinePopupHeader}</h2>
                                    </header>
                                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                                        <center>
                                            <h2>{!v.QuotelinePopupDescription}</h2>
                                        </center>
                                    </div>
                                    <footer class="slds-modal__footer">
                                        <aura:if isTrue="{!v.isQuotelinedelete}">
                                            <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                                onclick="{!c.closeQuotelineModel}" />
                                            <lightning:button variant="brand" label="Delete" title="Delete"
                                                onclick="{!c.deleteSelectedQuoteItemlines}" />
                                        </aura:if>
                                    </footer>
                                </div>
                            </section>
                            <div class="slds-backdrop slds-backdrop_open"></div>
                        </div>
                    </aura:if>

                    <aura:if isTrue="{!!v.displayGrouping}">


                        <!-- <div class="slds mainTablediv"> -->
                        <div class="slds-scrollable">
                            <div>
                                <!--<div class="slds-scrollable" style="width:100%;height: 35rem;">-->

                                <table
                                    class="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal tablecls">
                                    <!--Table must be responsive-->
                                    <thead></thead>
                                    <tbody >
                                        <aura:iteration items="{!v.TotalRecords.groups}" var="group"
                                            indexVar="groupIndex">
                                            <tr class="groupHeader">
                                                <td colspan="{!v.TotalRecords.Totalcols}" style="line-height:3vh;">
                                                    <div class="setting slds-grid slds-gutters  ">
                                                        <!-- <div style="float: right !important;">-->
                                                        <!-- <div style="float: right;" class="slds-p-right_small">-->

                                                        <div class="slds-p-left_x-large">
                                                            <span style="display: none; margin-top:-0.9rem;"
                                                                class="{!v.quoteId+' expandGrpIcon_'+groupIndex}"
                                                                data-grpindex="{!groupIndex}"
                                                                onclick="{!c.expandCollapseGroups}">
                                                                <lightning:icon iconName="utility:add" size="xx-small"
                                                                    alternativeText="add"
                                                                    style="border: 1px solid #b9b9b9; padding: 0.1rem 0.3rem 0.3rem 0.3rem" />
                                                            </span>
                                                        </div>
                                                        <!-- <span style="display:none;" class="{!'hideCollapseIcon collapseGrpIcon_'+parentGroupIndex}" data-grpindex="{!parentGroupIndex}" onclick="{!c.expandCollapseGroups}"> -->
                                                        <span style="display:inline-block;"
                                                            class="{!v.quoteId+' collapseGrpIcon_'+groupIndex}"
                                                            data-grpindex="{!groupIndex}"
                                                            onclick="{!c.expandCollapseGroups}">
                                                            <lightning:icon iconName="utility:dash" size="xx-small"
                                                                alternativeText="dash"
                                                                style="border: 1px solid #b9b9b9; padding: 0.1rem 0.3rem 0.3rem 0.3rem" />
                                                        </span>



                                                        <!-- <span class="{!'expandGrpIcon_'+groupIndex}" style="" data-grpindex="{!groupIndex}" onclick="{!c.expandCollapseGroups}">
                                                    <lightning:icon
                                                                    iconName="utility:add"
                                                                    size="xx-small"
                                                                    alternativeText="add"  style="border: 1px solid #b9b9b9; padding: 0.1rem 0.3rem 0.3rem 0.3rem"/>
                                                </span>
                                                <span class="{!'hideCollapseIcon collapseGrpIcon_'+groupIndex}" data-grpindex="{!groupIndex}" onclick="{!c.expandCollapseGroups}">
                                                    <lightning:icon
                                                                    iconName="utility:dash"
                                                                    size="xx-small"
                                                                    alternativeText="dash"  style="border: 1px solid #b9b9b9; padding: 0.1rem 0.3rem 0.3rem 0.3rem"/>
                                                </span> -->
                                                        <!-- <div class="slds-col slds-size_6-of-12" data-index='{!groupIndex}'
                                                    onclick="{!c.onClickChangeGroupName}"> -->
                                                        <div class="slds-col slds-size_6-of-12 width"
                                                            style="font-size: 17px;">
                                                            <!-- <span style=" margin-right:-60px; margin-left: -60px; !important;" >-->

                                                            {!group.Name}

                                                        </div>
                                                        <div class="slds-col slds-size_6-of-12 slds-float_right"
                                                            style="font-size: 10px; height:1.5rem; width:0px;">
                                                            <lightning:button variant="neutral" label="Add Quote Line"
                                                                name="{!groupIndex}" title="Add Quote Line"
                                                                class="addBudgetLineStyle"
                                                                onclick="{!c.addProductFromGroup}" />
                                                        </div>
                                                    </div>
                                                    <!-- <div class="slds-grid slds-gutters">
                                                <div class="slds-col slds-size_1-of-12">
                                                    <aura:if
                                                        isTrue="{!if(group.buildertek__Description__c!=null,true,false)}">
                                                        <div title="Description" onclick="{!c.addGroupDescription}"
                                                            data-index='{!groupIndex}'
                                                            style="font-size: 14px !important;">
                                                            {!group.buildertek__Description__c}
                                                        </div>
                                                        <aura:set attribute="else">
                                                            <div onclick="{!c.addGroupDescription}"
                                                                data-index='{!groupIndex}'
                                                                style="font-size: 14px !important;">
                                                                Click to edit description.
                                                            </div>
                                                        </aura:set>
                                                    </aura:if>
                                                </div>
                                            </div> -->

                                                </td>
                                                
                                            </tr>
                                            <tr class="slds-text-heading--label" style="line-height: 2;font-size: 12px;">
                                                <th></th>
                                                <th class="slds-is-sortable tabletitle" scope="col" width="5px">
                                                    <div class="slds-form-element">
                                                        <div class="slds-form-element__control">
                                                            <label class="slds-checkbox" width="10px">
                                                                <ui:inputCheckbox value="{!group.isSelected}"
                                                                    name="{!group.Name}" change="{!c.handleSelectAll}"
                                                                    aura:id="selectAll" class="" />
                                                                <span class="slds-checkbox--faux"
                                                                    style="top:-2px;"></span>
                                                                <span class="slds-form-element__label text"></span>
                                                            </label>
                                                        </div>
                                                    </div>
                                                </th>
                                                <th style="width: 80px !important;"></th>
                                                <aura:iteration items="{!v.columns}" var="col">
                                                    <aura:if
                                                        isTrue="{!and(col.fieldName!='Name',and(col.fieldName!='buildertek__Notes__c',col.fieldType!='reference'))}">
                                                        <th class="slds-is-sortable inputCss tabletitle" scope="col"
                                                            style="padding-right:5px !important;padding-left:5px !important;">
                                                            <div class="slds-truncate" title="{!col.label}">{!col.label}
                                                            </div>
                                                        </th>
                                                        <aura:set attribute="else">
                                                            <aura:if isTrue="{!and(col.fieldType=='reference')}">
                                                                <th class="slds-is-sortable lookupCss" scope="col"
                                                                    style="padding-right:5px !important;padding-left:5px !important;">
                                                                    <div class="slds-truncate" title="{!col.label}">
                                                                        {!col.label}
                                                                    </div>
                                                                </th>
                                                                <aura:set attribute="else">
                                                                    <th class="slds-is-sortable" scope="col"
                                                                        style="padding-right:5px !important;padding-left:5px !important;">
                                                                        <div class="slds-truncate" title="{!col.label}">
                                                                            {!col.label}
                                                                        </div>
                                                                    </th>
                                                                </aura:set>
                                                            </aura:if>
                                                        </aura:set>
                                                    </aura:if>
                                                </aura:iteration>
                                            </tr>
                                            <aura:iteration items="{!v.TotalRecords.tarTable.ListOfEachRecord}"
                                                var="tar" indexVar="quoteIndex">
                                                <tr style="line-height: 2.5;display:table-row;"
                                                    class="{!v.quoteId+' slds-hint-parent groupRows_'+groupIndex}">
                                                    <!-- quoteId -->

                                                    <aura:if isTrue="{!group.Id == tar.groupId}">

                                                        <td style="width: 40px;">
                                                            {!tar.recordCount +1}
                                                        </td>
                                                        <td>
                                                            <div class="slds-form-element">
                                                                <div class="slds-form-element__control">
                                                                    <label class="slds-checkbox" style="width:2px;">
                                                                        <ui:inputCheckbox text="{!tar.recordId}"
                                                                            aura:id="checkQuoteItem"
                                                                            value="{!tar.isSelected}"
                                                                            change="{!c.unCheckAll}" />
                                                                        <span class="slds-checkbox--faux"
                                                                            style="top:-2px;"></span>
                                                                        <span
                                                                            class="slds-form-element__label text"></span>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td style="text-align:left;">
                                                            <div class="slds-truncate">
                                                                <span data-id="{!tar.recordId}"
                                                                    onclick="{!c.onclickDuplicate}">
                                                                    <lightning:icon iconName="utility:copy"
                                                                        size="xx-small" />
                                                                    &nbsp;
                                                                </span>
                                                                <span data-id="{!tar.recordId}"
                                                                    onclick="{!c.editQuote}">
                                                                    <lightning:icon iconName="utility:edit"
                                                                        size="xx-small" />
                                                                    &nbsp;
                                                                </span>
                                                                <span data-id="{!tar.recordId}"
                                                                    onclick="{!c.deleteQuote}">
                                                                    <lightning:icon iconName="utility:delete"
                                                                        size="xx-small" />
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <td scope="row" class="slds-cell-edit" data-label="Name">
                                                            <aura:if
                                                                isTrue="{!or(and(and(v.isEditMode, v.fieldName == 'Name'), v.quoteItemId == tar.recordId),and(v.enableMassUpdate))}">
                                                                <ui:inputText aura:id="inputId"
                                                                    value="{!tar.recordName}"
                                                                    change="{!c.updateQuoteData}" blur="{!c.onblur}" />
                                                                <aura:set attribute="else">
                                                                    <div class="slds-truncate"
                                                                        title="{!tar.recordName}" style="white-space: normal; word-wrap: break-word;">
                                                                        <a href="javascript:void(0);" role="menuitem"
                                                                            tabindex="-1" data-record="{!tar.recordId}"
                                                                            onclick="{!c.doView}">
                                                                            {!tar.recordName}
                                                                        </a>
                                                                        <button
                                                                            class="slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small"
                                                                            tabindex="-1" title="">
                                                                            <span style="display:none;"
                                                                                data-id="{!tar.recordId}"
                                                                                data-label="Name"
                                                                                data-group="{!tar.groupId}"
                                                                                onclick="{!c.inlineEdit}">
                                                                                <lightning:icon iconName="utility:edit"
                                                                                    size="xx-small"
                                                                                    alternativeText="edit" />
                                                                            </span>
                                                                            <span
                                                                                class="slds-assistive-text">Edit</span>
                                                                        </button>
                                                                    </div>
                                                                </aura:set>
                                                            </aura:if>
                                                        </td>
                                                        <aura:iteration items="{!tar.recordList}" var="value">
                                                            <td class="ShowIconClass" data-myvalue="{!value}">
                                                                <aura:if isTrue="{!
                                                                    or(
                                                                        and(
                                                                            and(
                                                                                v.isEditMode, v.fieldName == value.fieldName
                                                                            ),
                                                                            v.quoteItemId == tar.recordId
                                                                        ),
                                                                        and(
                                                                            v.enableMassUpdate,
                                                                            or(
                                                                                or(
                                                                                    or(
                                                                                        or(
                                                                                            or(
                                                                                                or(
                                                                                                    or(
                                                                                                        value.fieldName=='buildertek__Quantity__c',
                                                                                                        or(
                                                                                                            or(
                                                                                                                value.fieldName == 'buildertek__Unit_Price__c',
                                                                                                                
                                                                                                                or(
                                                                                                                    value.fieldName == 'buildertek__Priority__c' ,
                                                                                                                    or(
                                                                                                                        value.fieldName == 'buildertek__Tax__c', value.fieldName == 'buildertek__Additional_Costs__c'
                                                                                                                    )

                                                                                                                )
                                                                                                            ),
                                                                                                            value.fieldName == 'buildertek__Vendor__c'
                                                                                                        )
                                                                                                    ),
                                                                                                    value.fieldName=='buildertek__Additional_Discount__c'
                                                                                                ),
                                                                                                value.fieldName=='buildertek__Unit_Cost__c'
                                                                                            ),
                                                                                            value.fieldName=='buildertek__Applied_Markup__c'
                                                                                        ),
                                                                                        value.fieldName == 'buildertek__UOM__c'
                                                                                    ),
                                                                                    value.fieldName == 'buildertek__Markup__c'
                                                                                ),
                                                                                value.fieldName == 'buildertek__Margin__c'
                                                                            ),
                                                                            value.fieldName=='buildertek__Notes__c' 
                                                                        )
                                                                    )
                                                                }">
                                                                    <aura:if isTrue="{!value.fieldType != 'picklist'}">
                                                                        <aura:if
                                                                            isTrue="{!value.fieldType == 'reference'}">
                                                                            <c:BT_LookupFields
                                                                                childObjectName="buildertek__Quote_Item__c"
                                                                                selectedRecordId="{!value.originalValue}"
                                                                                fieldName="{!value.fieldName}"
                                                                                index="{!quoteIndex}" />
                                                                            <aura:set attribute="else">
                                                                                <ui:inputText aura:id="inputId"
                                                                                    value="{!value.originalValue}"
                                                                                    change="{!c.updateQuoteData}"
                                                                                    blur="{!c.onblur}" />
                                                                            </aura:set>
                                                                        </aura:if>

                                                                        <aura:set attribute="else">
                                                                            <ui:inputSelect
                                                                                value="{! value.originalValue }"
                                                                                class="select-class">
                                                                                <aura:iteration var="option"
                                                                                    items="{! v.options }">
                                                                                    <option value="{! option.value }"
                                                                                        selected="{!value.originalValue == option.value}">
                                                                                        {! option.label }</option>
                                                                                </aura:iteration>
                                                                            </ui:inputSelect>
                                                                        </aura:set>
                                                                    </aura:if>
                                                                    <aura:set attribute="else">
                                                                        <div class="slds-truncate">
                                                                            <aura:if
                                                                                isTrue="{!value.fieldType == 'currency'}">
                                                                                <aura:if
                                                                                    isTrue="{!value.originalValue != ''}">
                                                                                    <aura:if
                                                                                        isTrue="{!value.fieldName != 'buildertek__Net_Unit__c'}">
                                                                                        <lightning:formattedNumber
                                                                                            value="{!value.originalValue}"
                                                                                            style="currency"
                                                                                            class="inputCss"
                                                                                            currencyCode="{!v.currencycode}"
                                                                                            currencyDisplayAs="code" />
                                                                                        <aura:set attribute="else">
                                                                                            <span
                                                                                                data-id="{!tar.recordId}"
                                                                                                onclick="{!c.editUnitPrice}">
                                                                                                <lightning:icon
                                                                                                    iconName="utility:edit"
                                                                                                    size="xx-small" />
                                                                                                &nbsp;
                                                                                            </span>
                                                                                            <lightning:formattedNumber
                                                                                                value="{!value.originalValue}"
                                                                                                style="currency"
                                                                                                class="inputCss"
                                                                                                currencyCode="{!v.currencycode}"
                                                                                                currencyDisplayAs="code" />
                                                                                        </aura:set>
                                                                                    </aura:if>
                                                                                    <aura:set attribute="else">
                                                                                        <lightning:formattedNumber
                                                                                            value="0.00"
                                                                                            style="currency"
                                                                                            class="inputCss"
                                                                                            currencyCode="{!v.currencycode}"
                                                                                            currencyDisplayAs="code" />
                                                                                    </aura:set>
                                                                                </aura:if>

                                                                            </aura:if>

                                                                            <aura:if
                                                                                isTrue="{!value.fieldType == 'number'}">

                                                                                <lightning:formattedNumber
                                                                                    value="{!value.originalValue}"
                                                                                    class="inputCss" />
                                                                            </aura:if>
                                                                            <aura:if
                                                                                isTrue="{!value.fieldType == 'string'}">

                                                                                <lightning:formattedNumber
                                                                                    value="{!value.originalValue/100}"
                                                                                    style="percent"
                                                                                    minimumFractionDigits="2"
                                                                                    class="inputCss" />
                                                                            </aura:if>
                                                                            <aura:if isTrue="{!value.fieldType == 'textarea'}">
                                                                                <div class="textAreaDiv">
                                                                                    <lightning:formattedRichText
                                                                                        value="{!value.originalValue}"
                                                                                        class="textAreaCss" />
                                                                                </div>
                                                                            </aura:if>
                                                                            <aura:if
                                                                                isTrue="{!value.fieldType == 'picklist'}">
                                                                                {!value.originalValue}
                                                                            </aura:if>
                                                                            <aura:if isTrue="{!value.referenceValue}">
                                                                                <ui:outputURL
                                                                                    value="{!'/one/one.app?#/sObject/'+ value.originalValue + '/view'}"
                                                                                    target="_blank"
                                                                                    label="{!value.referenceValue}" />
                                                                            </aura:if>
                                                                            <button
                                                                                class="slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small"
                                                                                tabindex="-1" title="">
                                                                                <aura:if
                                                                                    isTrue="{!value.isEditable == true}">
                                                                                    <span style="display:none;"
                                                                                        data-id="{!tar.recordId}"
                                                                                        data-label="{!value.fieldName}"
                                                                                        data-group="{!tar.groupId}"
                                                                                        onclick="{!c.inlineEdit}">
                                                                                        <lightning:icon
                                                                                            iconName="utility:edit"
                                                                                            size="xx-small"
                                                                                            alternativeText="edit" />
                                                                                    </span>
                                                                                </aura:if>
                                                                                <span
                                                                                    class="slds-assistive-text">Edit</span>
                                                                            </button>
                                                                        </div>
                                                                    </aura:set>
                                                                </aura:if>
                                                            </td>
                                                        </aura:iteration>
                                                    </aura:if>
                                                </tr>
                                            </aura:iteration>
                                            <tr class="groupFooter">
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <td></td>
                                                <aura:iteration items="{!v.TotalRecords.wrapperList}" var="rec" indexVar="totalRecordsIndex">
                                                    <aura:if isTrue="{!group.Name == rec.groupName &amp;&amp; rec.fieldType != 'false'}">
                                                        <aura:if isTrue="{!rec.fieldType == 'CURRENCY'}">
                                                            <td>
                                                                
                                                                <aura:if isTrue="{!rec.totalValue != null}">
                                                                    <span style="font-weight: bold;">
                                                                        <lightning:formattedNumber value="{!rec.totalValue}" style="currency" currencyCode="{!v.currencycode}" currencyDisplayAs="code" />
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0.00" style="currency" class="inputCss" currencyCode="{!v.currencycode}" currencyDisplayAs="code" />
                                                                        </aura:set>
                                                                    </span>
                                                                </aura:if>
                                                                <button class="slds-button slds-button_icon slds-cell-edit__button slds-m-left_x-small" tabindex="-1" title="">
                                                                    <span style="display:none;">
                                                                    </span>
                                                                    <span class="slds-assistive-text">Edit</span>
                                                                </button>
                                                            </td>
                                                        </aura:if>

                                                        <aura:if isTrue="{! and(rec.fieldType == 'DOUBLE', rec.fieldLabel == 'buildertek__Quantity__c')}">
                                                            <td>
                                                                
                                                                <aura:if isTrue="{!rec.totalValue != null}">
                                                                    <span style="font-weight: bold;">
                                                                        <lightning:formattedNumber value="{!rec.totalValue}" />
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0.00" />
                                                                        </aura:set>
                                                                    </span>
                                                                </aura:if>
                                                                
                                                            </td>
                                                        </aura:if>


                                                       
                                                    </aura:if>

                                                    <!-- <aura:if isTrue="{rec.fieldLabel == 'buildertek__Tax__c'}">
                                                        
                                                        <td style="text-align:left">
                                                        </td>
                                                     </aura:if> -->

                                                    <aura:if isTrue="{!group.Name == rec.groupName &amp;&amp; rec.fieldType == 'false' &amp;&amp; rec.fieldLabel != 'Id' &amp;&amp; rec.fieldLabel != 'buildertek__Grouping__c'}">
                                                        
                                                            <td style="text-align:left">
                                                            </td>
                                                    </aura:if>
                                                </aura:iteration>
                                            </tr>
                                            <br />

                                            <!--<br />
                                    <br />-->
                                        </aura:iteration>
                                        <aura:if isTrue="{!empty(v.TotalRecords.groups)}">
                                            <div class="slds-col slds-size_6-of-12 slds-float_right"
                                                style="font-size: 10px; height:1.5rem;">
                                                <lightning:button variant="neutral" label="Add Quote Line"
                                                    name="{!groupIndex}" title="Add Quote Line"
                                                    class="addBudgetLineStyle" onclick="{!c.addProductFromGroup}" />
                                            </div>
                                        </aura:if>
                                    </tbody>
                                </table>

                            </div>
                            <!--<br />-->
                            <aura:if isTrue="{!v.total > 50}">
                                <div class="slds-align_absolute-center">
                                    <lightning:button disabled="{!v.page == 1}" variant="brand" label="Previous"
                                        onclick="{! c.navigate }" />
                                    <lightning:button disabled="{!v.page == v.pages}" aura:id="previousPage"
                                        variant="brand" label="Next" onclick="{! c.navigate }" />
                                </div>
                            </aura:if>

                        </div>

                            <!-- <br />-->
                        <!-- </div> -->

                        <!-- *** BOM Grouping *** -->
                        <aura:set attribute="else">
                            <div class="mainBomDiv">
                                <table class="slds-table slds-table--bordered slds-max-medium-table--stacked-horizontal">
                                    <tbody>
                                        <aura:if isTrue="{!v.firstGrouping}">
                                            <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                                                <tr>
                                                    <td class="groupHeaderIcon">
                                                        <div id='collapseBtn' class="slds-float_left">
                                                            <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                                                <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                                            </span>
                                                            <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex}" onclick="{!c.expandCollapeGroup}"  style="display:inline-block;">
                                                                <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                                            </span>
                                                        </div>
                                                    </td>
                                                    <td class="groupHeaderDiv" colspan="{!v.totalColumn+3}">
                                                        <aura:if isTrue="{!group1.groupName != undefined}">
                                                            {!group1.groupName}
                                                            <aura:set attribute="else">
                                                                No Grouping
                                                            </aura:set>
                                                        </aura:if>
                                                    </td>
                                                </tr>
                                                <tr style='line-height: 2;font-size: 12px;' class="slds-text-heading--label">
                                                    <th class="tableHeaderDiv blankDiv"></th>
                                                    <th class="tableHeaderDiv slds-is-sortable tabletitle" scope="col" width="5px">
                                                            <div class="slds-form-element">
                                                                <div class="slds-form-element__control">
                                                                    <label class="slds-checkbox" width="10px">
                                                                        <ui:inputCheckbox name="{!group1.groupName}" value="{!group1.isSelected}" change="{!c.handleSelectAllGroup}" aura:id="selectAllGroup" class="" />
                                                                        <span class="slds-checkbox--faux" style="top:-2px;"></span>
                                                                        <span class="slds-form-element__label text"></span>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                    </th>
                                                    <th class="tableHeaderDiv blankDiv"></th>

                                                    <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                        
                                                        <th class="tableHeaderDiv">
                                                            {!col.label}
                                                        </th>
                                                    </aura:iteration>
                                                </tr>
                                                <aura:iteration items="{!group1.quoteLineList}" var="quoteItem">
                                                    <tr style="line-height: 2.5;display:table-row;" class="{!'record_'+group1.groupIndex}" >
                                                        <td class="blankDiv"></td>
                                                        <td>
                                                            <div class="slds-form-element">
                                                                <div class="slds-form-element__control">
                                                                    <label class="slds-checkbox" style="width:2px;">
                                                                        <ui:inputCheckbox aura:id='checkGroupQuoteItem1' name="{!quoteItem.buildertek__Grouping__c}" text="{!quoteItem.Id}" value="{!quoteItem.isSelected}" change="{!c.unCheckAllGroup}" />
                                                                        <span class="slds-checkbox--faux"  style="top:-2px;"></span>
                                                                        <span  class="slds-form-element__label text"></span>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </td>
                                                        <td style="text-align:left;">
                                                            <div class="slds-truncate">
                                                                <span data-id="{!quoteItem.Id}"  onclick="{!c.onclickDuplicate}">
                                                                    <lightning:icon iconName="utility:copy" size="xx-small" />
                                                                    &nbsp;
                                                                </span>
                                                                <span data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                                                    <lightning:icon iconName="utility:edit" size="xx-small" />
                                                                    &nbsp;
                                                                </span>
                                                                <span data-id="{!quoteItem.Id}" onclick="{!c.deleteQuote}">
                                                                    <lightning:icon iconName="utility:delete" size="xx-small" />
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                                            <td>
                                                                <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                                    || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                    <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                                        <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                                    </aura:if>

                                                                    <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                                        <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                            <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                                            <aura:set attribute="else">
                                                                                <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </aura:if>

                                                                    <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                                                        <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                            <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                            <aura:set attribute="else">
                                                                                <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </aura:if>

                                                                    <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                                    fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                        <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                            <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                                            <aura:set attribute="else">
                                                                                <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </aura:if>

                                                                    <aura:set attribute="else">
                                                                        {!fildData.fieldValue}
                                                                    </aura:set>
                                                                </aura:if>
                                                            </td>
                                                        </aura:iteration>
                                                    </tr>
                                                </aura:iteration>
                                                <tr style="font-weight: bold;">
                                                    <td class="blankDiv" colspan="3"> </td>
                                                    <aura:iteration items="{!group1.fieldTotals.fieldTotalList}"
                                                        var="total">
                                                        <td>
                                                            <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                <span>Total</span>
                                                            </aura:if>
                                                            <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                <aura:if isTrue="{!total.fieldValue != null}">
                                                                    <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                    <aura:set attribute="else">
                                                                        <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                    </aura:set>
                                                                </aura:if>
                                                            </aura:if>
                                                        </td>
                                                    </aura:iteration>
                                                </tr>
                                            </aura:iteration>
                                        </aura:if>

                                        <aura:if isTrue="{!v.secondGrouping}">
                                            <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                                                <tr>
                                                    <td class="groupHeaderDiv" colspan="3">
                                                        <aura:if isTrue="{!group1.groupName != undefined}">
                                                            {!group1.groupName}
                                                            <aura:set attribute="else">
                                                                No Grouping
                                                            
                                                            </aura:set>
                                                        </aura:if>
                                                    </td>
                                                    <aura:iteration items="{!group1.fieldTotals.fieldTotalList}" var="total">
                                                        <td class="groupHeaderTotal">
                                                            <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                    <span>Total</span>
                                                            </aura:if>
                                                            <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                <aura:if isTrue="{!total.fieldValue != null}">
                                                                    <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                    <aura:set attribute="else">
                                                                        <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                    </aura:set>
                                                                </aura:if>
                                                            </aura:if>
                                                        </td>
                                                    </aura:iteration>
                                                </tr>
                                                
                                                <aura:iteration items="{!group1.quoteLineList}" var="group2">
                                                    <tr>
                                                        <td class="groupHeaderIcon">
                                                            <div id='collapseBtn' class="slds-float_left">
                                                                <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex+group2.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                                                    <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                                                </span>
                                                                <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex+group2.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:inline-block;">
                                                                    <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <td class="groupHeaderDiv" colspan="{!v.totalColumn+3}">
                                                            <aura:if isTrue="{!group2.groupName != undefined}">
                                                                {!group2.groupName}
                                                                <aura:set attribute="else">
                                                                    No Grouping
                                                                </aura:set>
                                                            </aura:if>
                                                        </td>
                                                    </tr>
                                                    <tr>
                                                        <th class="tableHeaderDiv blankDiv"></th>

                                                        <th class="tableHeaderDiv slds-is-sortable tabletitle" scope="col" width="5px">
                                                            <div class="slds-form-element">
                                                                <div class="slds-form-element__control">
                                                                    <label class="slds-checkbox" width="10px">
                                                                        <ui:inputCheckbox name="{!group1.groupName+'_'+group2.groupName}" value="{!group2.isSelected}" change="{!c.handleSelectAllGroup}" aura:id="selectAllGroup" class="" />
                                                                        <span class="slds-checkbox--faux" style="top:-2px;"></span>
                                                                        <span class="slds-form-element__label text"></span>
                                                                    </label>
                                                                </div>
                                                            </div>
                                                        </th>
                                                        <th class="tableHeaderDiv blankDiv"></th>

                                                         <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                                            <th class="tableHeaderDiv">
                                                                {!col.label}
                                                            </th>
                                                        </aura:iteration>
                                                    </tr>
                                                    <aura:iteration items="{!group2.quoteLineList}" var="quoteItem">
                                                        <tr style="line-height: 2.5;display:table-row;"  class="{!'record_'+group1.groupIndex+group2.groupIndex}">
                                                            <td class="blankDiv"> </td>
                                                            <td>
                                                                <div class="slds-form-element">
                                                                    <div class="slds-form-element__control">
                                                                        <label class="slds-checkbox" style="width:2px;">
                                                                            <ui:inputCheckbox name="{!group1.groupName+'_'+group2.groupName}"   aura:id='checkGroupQuoteItem1' text="{!quoteItem.Id}" value="{!quoteItem.isSelected}" change="{!c.unCheckAllGroup}" />
                                                                            <span class="slds-checkbox--faux"  style="top:-2px;"></span>
                                                                            <span  class="slds-form-element__label text"></span>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </td>
                                                            <td style="text-align:left;">
                                                                <div class="slds-truncate">
                                                                    <span data-id="{!quoteItem.Id}" onclick="{!c.onclickDuplicate}">
                                                                        <lightning:icon iconName="utility:copy" size="xx-small" />
                                                                        &nbsp;
                                                                    </span>
                                                                    <span  data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                                                        <lightning:icon iconName="utility:edit" size="xx-small" />
                                                                        &nbsp;
                                                                    </span>
                                                                    <span data-id="{!quoteItem.Id}" onclick="{!c.deleteQuote}">
                                                                        <lightning:icon iconName="utility:delete" size="xx-small" />
                                                                    </span>
                                                                </div>
                                                            </td>  
                                                            <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                                                <td>
                                                                    <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                                        || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                        <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                                            <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                                        </aura:if>

                                                                        <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                                                <aura:set attribute="else">
                                                                                    <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </aura:if>

                                                                        <aura:if
                                                                            isTrue="{!fildData.fieldType == 'currency'}">
                                                                            <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                                <aura:set attribute="else">
                                                                                    <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </aura:if>

                                                                        <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                                        fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                            <aura:if
                                                                                isTrue="{!fildData.fieldValue != null}">
                                                                                <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                                                <aura:set attribute="else">
                                                                                    <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </aura:if>

                                                                        <aura:set attribute="else">
                                                                            {!fildData.fieldValue}
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </td>
                                                            </aura:iteration>
                                                        </tr>
                                                    </aura:iteration>
                                                    <tr style="font-weight: bold;">
                                                        <td class="blankDiv" colspan="3"> </td>
                                                        <aura:iteration items="{!group2.fieldTotals.fieldTotalList}" var="total">
                                                            <td>
                                                                <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                    <span>Total</span>
                                                                </aura:if>
                                                                <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                    <aura:if isTrue="{!total.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                                                            </td>
                                                        </aura:iteration>
                                                    </tr>
                                                    <br/>
                                                </aura:iteration>
                                                
                                            </aura:iteration>
                                        </aura:if>


                                        <aura:if isTrue="{!v.thirdGrouping}">
                                            <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                                                <tr>
                                                    <td class="groupHeaderDiv" colspan="4">
                                                        <aura:if isTrue="{!group1.groupName != undefined}">
                                                            {!group1.groupName}
                                                            <aura:set attribute="else">
                                                                No Grouping
                                                            </aura:set>
                                                        </aura:if>
                                                    </td>
                                                    <aura:iteration items="{!group1.fieldTotals.fieldTotalList}" var="total">
                                                        <td class="groupHeaderTotal">
                                                            <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                <span>Total</span>
                                                            </aura:if>
                                                            <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                <aura:if isTrue="{!total.fieldValue != null}">
                                                                    <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                    <aura:set attribute="else">
                                                                        <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                    </aura:set>
                                                                </aura:if>
                                                            </aura:if>
                                                        </td>
                                                    </aura:iteration>
                                                </tr>
                                                <aura:iteration items="{!group1.quoteLineList}" var="group2">
                                                    <tr>
                                                        <td class="groupHeaderDiv blankDiv"> </td>
                                                        <td class="groupHeaderDiv" colspan="3">
                                                            <aura:if isTrue="{!group2.groupName != undefined}">
                                                                {!group2.groupName}
                                                                <aura:set attribute="else">
                                                                    No Grouping
                                                                </aura:set>
                                                            </aura:if>
                                                        </td>

                                                        <aura:iteration items="{!group2.fieldTotals.fieldTotalList}" var="total">
                                                            <td class="groupHeaderTotal">
                                                                <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                    <span>Total</span>
                                                                </aura:if>
                                                                <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                    <aura:if isTrue="{!total.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                                                            </td>
                                                        </aura:iteration>
                                                    </tr>
                                                    <aura:iteration items="{!group2.quoteLineList}" var="group3">
                                                        <tr>
                                                            <td class="groupHeaderDiv blankDiv"> </td>
                                                            <td class="groupHeaderIcon">
                                                                <div id='collapseBtn' class="slds-float_left">
                                                                    <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                                                        <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                                                    </span>
                                                                    <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:inline-block;">
                                                                        <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                                                    </span>
                                                                </div>
                                                            </td>
                                                            <td class="groupHeaderDiv" colspan="{!v.totalColumn+2}">
                                                                <aura:if isTrue="{!group3.groupName != undefined}">
                                                                    {!group3.groupName}
                                                                    <aura:set attribute="else">
                                                                        No Grouping
                                                                    </aura:set>
                                                                </aura:if>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <th class="tableHeaderDiv blankDiv" colspan="2"></th>
                                                            <th class="tableHeaderDiv slds-is-sortable tabletitle" scope="col" width="5px">
                                                                <div class="slds-form-element">
                                                                    <div class="slds-form-element__control">
                                                                        <label class="slds-checkbox" width="10px">
                                                                            <ui:inputCheckbox name="{!group1.groupName+'_'+group2.groupName+'_'+group3.groupName}" value="{!group3.isSelected}" change="{!c.handleSelectAllGroup}" aura:id="selectAllGroup" class="" />
                                                                            <span class="slds-checkbox--faux" style="top:-2px;"></span>
                                                                            <span class="slds-form-element__label text"></span>
                                                                        </label>
                                                                    </div>
                                                                </div>
                                                            </th>                                                            
                                                            <th class="tableHeaderDiv blankDiv"></th>
                                                            <aura:iteration items="{!v.QuoteLineWrapper.columns}"
                                                                var="col">
                                                                <th class="tableHeaderDiv">
                                                                    {!col.label}
                                                                </th>
                                                            </aura:iteration>
                                                        </tr>
                                                        <aura:iteration items="{!group3.quoteLineList}" var="quoteItem">
                                                            <tr style="line-height: 2.5;display:table-row;"  class="{!'record_'+group1.groupIndex+group2.groupIndex+group3.groupIndex}">
                                                                <td class="blankDiv" colspan="2"> </td>
                                                                <td>
                                                                    <div class="slds-form-element">
                                                                        <div class="slds-form-element__control">
                                                                            <label class="slds-checkbox" style="width:2px;">
                                                                                <ui:inputCheckbox name="{!group1.groupName+'_'+group2.groupName+'_'+group3.groupName}"   aura:id='checkGroupQuoteItem1' text="{!quoteItem.Id}" value="{!quoteItem.isSelected}" change="{!c.unCheckAllGroup}" />
                                                                                <span class="slds-checkbox--faux"  style="top:-2px;"></span>
                                                                                <span  class="slds-form-element__label text"></span>
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                </td>                                                              
                                                                 <td style="text-align:left;">
                                                                <div class="slds-truncate">
                                                                    <span data-id="{!quoteItem.Id}"  onclick="{!c.onclickDuplicate}">
                                                                        <lightning:icon iconName="utility:copy" size="xx-small" />
                                                                        &nbsp;
                                                                    </span>
                                                                    <span  data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                                                        <lightning:icon iconName="utility:edit" size="xx-small" />
                                                                        &nbsp;
                                                                    </span>
                                                                    <span data-id="{!quoteItem.Id}" onclick="{!c.deleteQuote}">
                                                                        <lightning:icon iconName="utility:delete" size="xx-small" />
                                                                    </span>
                                                                </div>
                                                                </td>           
                                                                <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                                                    <td>
                                                                        <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                                            || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                            <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                                                <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                                            </aura:if>

                                                                            <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                                                <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                    <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                                                    <aura:set attribute="else">
                                                                                        <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                                                    </aura:set>
                                                                                </aura:if>
                                                                            </aura:if>

                                                                            <aura:if isTrue="{!fildData.fieldType == 'currency'}">
                                                                                <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                    <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                                    <aura:set attribute="else">
                                                                                        <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                                    </aura:set>
                                                                                </aura:if>
                                                                            </aura:if>

                                                                            <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                                            fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                                <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                    <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                                                    <aura:set attribute="else">
                                                                                        <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                                                    </aura:set>
                                                                                </aura:if>
                                                                            </aura:if>

                                                                            <aura:set attribute="else">
                                                                                {!fildData.fieldValue}
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </td>
                                                                </aura:iteration>
                                                            </tr>
                                                        </aura:iteration>
                                                        <tr style="font-weight: bold;">
                                                            <td class="blankDiv" colspan="4"> </td>
                                                            <aura:iteration items="{!group3.fieldTotals.fieldTotalList}" var="total">
                                                                <td>
                                                                    <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                        <span>Total</span>
                                                                    </aura:if>
                                                                    <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                        <aura:if isTrue="{!total.fieldValue != null}">
                                                                            <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                            <aura:set attribute="else">
                                                                                <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </aura:if>
                                                                </td>
                                                            </aura:iteration>
                                                        </tr>
                                                        <br/>
                                                    </aura:iteration>
                                                    
                                                </aura:iteration>
                                               
                                            </aura:iteration>
                                        </aura:if>

                                        <aura:if isTrue="{!v.forthGrouping}">
                                            <aura:iteration items="{!v.QuoteLineWrapper.groupWrapper}" var="group1">
                                                <tr>
                                                    <td class="groupHeaderDiv" colspan="6">
                                                        <aura:if isTrue="{!group1.groupName != undefined}">
                                                            {!group1.groupName}
                                                            <aura:set attribute="else">
                                                                No Grouping
                                                            </aura:set>
                                                        </aura:if>
                                                    </td>
                                                    <aura:iteration items="{!group1.fieldTotals.fieldTotalList}" var="total">
                                                        <td class="groupHeaderTotal">
                                                            <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                <span>Total</span>
                                                            </aura:if>
                                                            <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                <aura:if isTrue="{!total.fieldValue != null}">
                                                                    <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                    <aura:set attribute="else">
                                                                        <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                    </aura:set>
                                                                </aura:if>
                                                            </aura:if>
                                                        </td>
                                                    </aura:iteration>
                                                </tr>
                                                <aura:iteration items="{!group1.quoteLineList}" var="group2">
                                                    <tr>
                                                        <td class="groupHeaderDiv blankDiv"> </td>
                                                        <td class="groupHeaderDiv" colspan="5">
                                                            <aura:if isTrue="{!group2.groupName != undefined}">
                                                                {!group2.groupName}
                                                                <aura:set attribute="else">
                                                                    No Grouping
                                                                </aura:set>
                                                            </aura:if>
                                                        </td>
                                                        
                                                        <aura:iteration items="{!group2.fieldTotals.fieldTotalList}" var="total">
                                                            <td class="groupHeaderTotal">
                                                                <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                    <span>Total</span>
                                                                </aura:if>
                                                                <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                    <aura:if isTrue="{!total.fieldValue != null}">
                                                                        <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                        <aura:set attribute="else">
                                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                                                            </td>
                                                        </aura:iteration>
                                                    </tr>
                                                    <aura:iteration items="{!group2.quoteLineList}" var="group3">
                                                        <tr>
                                                            <td class="groupHeaderDiv blankDiv"> </td>
                                                            <td class="groupHeaderDiv blankDiv"> </td>
                                                            <td class="groupHeaderDiv" colspan="4">
                                                                <aura:if isTrue="{!group3.groupName != undefined}">
                                                                    {!group3.groupName}
                                                                    <aura:set attribute="else">
                                                                        No Grouping
                                                                    </aura:set>
                                                                </aura:if>
                                                            </td>
                                                            <aura:iteration items="{!group3.fieldTotals.fieldTotalList}" var="total">
                                                                <td class="groupHeaderTotal">
                                                                    <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                        <span>Total</span>
                                                                    </aura:if>
                                                                    <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                        <aura:if isTrue="{!total.fieldValue != null}">
                                                                            <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                            <aura:set attribute="else">
                                                                                <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </aura:if>
                                                                </td>
                                                            </aura:iteration>
                                                        </tr>
                                                        <aura:iteration items="{!group3.quoteLineList}" var="group4">
                                                            <tr>
                                                                <td class="groupHeaderDiv blankDiv"> </td>
                                                                <td class="groupHeaderDiv blankDiv"> </td>
                                                                <td class="groupHeaderDiv blankDiv"> </td>

                                                                <td class="groupHeaderIcon">
                                                                    <div id='collapseBtn' class="slds-float_left">
                                                                        <span data-iconname="Expand Group" id="{!'expandGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex+group4.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:none">
                                                                            <lightning:buttonIcon iconName="utility:add" variant="border-filled" iconClass="dark" alternativeText="Expand Group" title="Expand Group" />
                                                                        </span>
                                                                        <span data-iconname="Collapse Group" id="{!'collapeseGroupBtn_'+group1.groupIndex+group2.groupIndex+group3.groupIndex+group4.groupIndex}" onclick="{!c.expandCollapeGroup}" style="display:inline-block;">
                                                                            <lightning:buttonIcon iconName="utility:dash" variant="border-filled" iconClass="dark" alternativeText="Collapse Group" title="Collapse Group" />
                                                                        </span>
                                                                    </div>
                                                                </td>
                                                                <td class="groupHeaderDiv" colspan="{!v.totalColumn+2}">
                                                                    <aura:if isTrue="{!group4.groupName != undefined}">
                                                                        {!group4.groupName}
                                                                        <aura:set attribute="else">
                                                                            No Grouping
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <th class="tableHeaderDiv blankDiv"></th>
                                                                <th class="tableHeaderDiv blankDiv"></th>
                                                                <th class="tableHeaderDiv blankDiv"></th>
                                                                

                                                                <th class="tableHeaderDiv slds-is-sortable tabletitle" scope="col" width="5px">
                                                                    <div class="slds-form-element">
                                                                        <div class="slds-form-element__control">
                                                                            <label class="slds-checkbox" width="10px">
                                                                                <ui:inputCheckbox name="{!group1.groupName+'_'+group2.groupName+'_'+group3.groupName+'_'+group4.groupName}" value="{!group4.isSelected}" change="{!c.handleSelectAllGroup}" aura:id="selectAllGroup" class="" />
                                                                                <span class="slds-checkbox--faux" style="top:-2px;"></span>
                                                                                <span class="slds-form-element__label text"></span>
                                                                            </label>
                                                                        </div>
                                                                    </div>
                                                                </th>                                                              
                                                                <th class="tableHeaderDiv blankDiv"></th>
                                                                <th class="tableHeaderDiv blankDiv"></th>
                                                                
                                                                <aura:iteration items="{!v.QuoteLineWrapper.columns}" var="col">
                                                                    <th class="tableHeaderDiv">
                                                                        {!col.label}
                                                                    </th>
                                                                </aura:iteration>
                                                            </tr>
                                                            <aura:iteration items="{!group4.quoteLineList}" var="quoteItem">
                                                                <tr style="line-height: 2.5;display:table-row;"  class="{!'record_'+group1.groupIndex+group2.groupIndex+group3.groupIndex+group4.groupIndex}">
                                                                    <td class="blankDiv" colspan="3"> </td>
                                                                    <td>
                                                                        <div class="slds-form-element">
                                                                            <div class="slds-form-element__control">
                                                                                <label class="slds-checkbox" style="width:2px;">
                                                                                    <ui:inputCheckbox name="{!group1.groupName+'_'+group2.groupName+'_'+group3.groupName+'_'+group4.groupName}"   aura:id='checkGroupQuoteItem1' text="{!quoteItem.Id}" value="{!quoteItem.isSelected}" change="{!c.unCheckAllGroup}" />
                                                                                    <span class="slds-checkbox--faux"  style="top:-2px;"></span>
                                                                                    <span  class="slds-form-element__label text"></span>
                                                                                </label>
                                                                            </div>
                                                                        </div>
                                                                    </td>                                                                   
                                                                     <td class="blankDiv" > </td>
                                                                    <td style="text-align:left;">
                                                                        <div class="slds-truncate">
                                                                            <span data-id="{!quoteItem.Id}" onclick="{!c.onclickDuplicate}">
                                                                                <lightning:icon iconName="utility:copy"  size="xx-small" />
                                                                                &nbsp;
                                                                            </span>
                                                                            <span  data-id="{!quoteItem.Id}" onclick="{!c.editQuote}">
                                                                                <lightning:icon iconName="utility:edit" size="xx-small" />
                                                                                &nbsp;
                                                                            </span>
                                                                            <span data-id="{!quoteItem.Id}"  onclick="{!c.deleteQuote}">
                                                                                <lightning:icon iconName="utility:delete" size="xx-small" />
                                                                            </span>
                                                                        </div>
                                                                    </td>                                                                    
                                                                    <aura:iteration items="{!quoteItem.FieldDataList}" var="fildData">
                                                                        <td>
                                                                            <aura:if isTrue="{! (fildData.fieldType == 'number' || fildData.fieldType == 'currency' || fildData.fieldName == 'Name' || fildData.fieldName == 'buildertek__Markup__c' 
                                                                                                || fildData.fieldName == 'buildertek__Margin__c' || fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                                <aura:if isTrue="{!fildData.fieldName == 'Name'}">
                                                                                    <ui:outputURL value="{!'/one/one.app?#/sObject/'+ quoteItem.Id + '/view'}" target="_blank" label="{!fildData.fieldValue}" />
                                                                                </aura:if>

                                                                                <aura:if isTrue="{!fildData.fieldType == 'number'}">
                                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" maximumFractionDigits="2" />
                                                                                        <aura:set attribute="else">
                                                                                            <lightning:formattedNumber value="0" maximumFractionDigits="2" />
                                                                                        </aura:set>
                                                                                    </aura:if>
                                                                                </aura:if>

                                                                                <aura:if
                                                                                    isTrue="{!fildData.fieldType == 'currency'}">
                                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                        <lightning:formattedNumber value="{!fildData.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                                        <aura:set attribute="else">
                                                                                            <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                                        </aura:set>
                                                                                    </aura:if>
                                                                                </aura:if>

                                                                                <aura:if isTrue="{! (fildData.fieldName == 'buildertek__Markup__c' || fildData.fieldName == 'buildertek__Margin__c' || 
                                                                                                fildData.fieldName == 'buildertek__Additional_Discount__c' || fildData.fieldName == 'buildertek__Profit_Margin__c' )}">

                                                                                    <aura:if isTrue="{!fildData.fieldValue != null}">
                                                                                        <lightning:formattedNumber value="{!fildData.fieldValue/100}" style="percent" maximumFractionDigits="2" />
                                                                                        <aura:set attribute="else">
                                                                                            <lightning:formattedNumber value="0" style="percent" maximumFractionDigits="2" />
                                                                                        </aura:set>
                                                                                    </aura:if>
                                                                                </aura:if>

                                                                                <aura:set attribute="else">
                                                                                    {!fildData.fieldValue}
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </td>
                                                                    </aura:iteration>
                                                                </tr>
                                                            </aura:iteration>
                                                            <tr style="font-weight: bold;">
                                                                <td class="blankDiv"> </td>
                                                                <td class="blankDiv"> </td>
                                                                <td class="blankDiv"> </td>
                                                                <td class="blankDiv"> </td>
                                                                <td class="blankDiv"> </td>
                                                                <td class="blankDiv"> </td>

                                                                <aura:iteration items="{!group4.fieldTotals.fieldTotalList}" var="total">
                                                                    <td>
                                                                        <aura:if isTrue="{!total.fieldName == 'Total'}">
                                                                            <span>Total</span>
                                                                        </aura:if>
                                                                        <aura:if isTrue="{!total.fieldType == 'currency'}">
                                                                            <aura:if isTrue="{!total.fieldValue != null}">
                                                                                <lightning:formattedNumber value="{!total.fieldValue}" style="currency" currencyDisplayAs="code" />
                                                                                <aura:set attribute="else">
                                                                                    <lightning:formattedNumber value="0" style="currency" currencyDisplayAs="code" />
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </aura:if>
                                                                    </td>
                                                                </aura:iteration>
                                                            </tr>
                                                            <br/>
                                                        </aura:iteration>
                                                        
                                                    </aura:iteration>
                                                    
                                                </aura:iteration>
                                               
                                            </aura:iteration>
                                        </aura:if>

                                    </tbody>
                                </table>
                            </div>
                        </aura:set>
                    </aura:if>
                    <div class="slds-align_absolute-center">
                        <aura:if isTrue="{!v.showButtons}">
                            <center>
                                <lightning:buttonGroup class="slds-m-around_medium">
                                    <lightning:button label="Cancel" onclick="{!c.closeInlineEditForm}" />
                                    <lightning:button label="Save" onclick="{!c.SaveEditedValues}" variant="brand" />
                                </lightning:buttonGroup>
                            </center>
                        </aura:if>
                    </div>
                    <aura:if isTrue="{!v.editUnitPrice}">
                        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                            <div class="slds-modal__container">
                                <header class="slds-modal__header">
                                    <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeunitsalesprice }"
                                        alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                                    <h2 id="modal-heading-01" class="slds-text-heading_large slds-hyphenate">Update Unit
                                        Sales Price</h2>
                                </header>
                                <div class="slds-modal__content" id="modal-content-id-1">
                                    <div class="slds-p-around_large">

                                        <div class="slds-grid slds-gutters">
                                            <div class="slds-col slds-size_6-of-12">
                                                <label class="slds-form-element__label">UNIT SALES PRICE</label>
                                                <ui:inputNumber value="{!v.NetUnit}" />
                                            </div>
                                            <div class="slds-col slds-size_6-of-12">
                                            </div>
                                        </div>
                                    </div>
                                    <footer class="slds-modal__footer">
                                        <lightning:button variant="neutral" label="Cancel" title="Cancel"
                                            onclick="{! c.closeunitsalesprice }" />
                                        <lightning:button variant="brand" label="Save" title="Save"
                                            onclick="{!c.updateUnitSalesPrice}" />
                                    </footer>
                                </div>
                            </div>
                        </section>
                        <div class="slds-backdrop slds-backdrop_open"></div>
                    </aura:if>
                    <aura:if isTrue="{!v.openProductBox}">
                        <aura:html tag="style">
                        
                            .slds-modal__container{
                            width: 80% !important;
                            }
                            
                        </aura:html>                       
                            <c:Add_QuoteLine_In_Quote quoteId="{!v.recordId}" openProductBox="{!v.openProductBox}" />

                    </aura:if>

                    <aura:if isTrue="{!v.openQuoteLineBox}">
                        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                            aria-describedby="modal-content-id-1"
                            class="slds-modal slds-fade-in-open  slds-modal_large">
                            <div class="slds-modal__container">
                                <header class="slds-modal__header">
                                    <!--  <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeAddProductFromGroup }"
                        alternativeText="close" variant="bare-inverse" class="slds-modal__close" /> -->
                                    <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Edit
                                        Selected Quote Line Items</h2>
                                </header>
                                <div class="slds-modal__content" id="modal-content-id-1">
                                    <table aria-multiselectable="true"
                                        class="slds-card slds-table slds-table_bordered slds-table_fixed-layout slds-table_resizable-cols"
                                        role="grid">
                                        <thead style="height: 40px; ">
                                            <tr>

                                                <!--      <th style = "width: 68px; padding-left: 5px; border-radius: 3px;">
                                                
                                                <label class="slds-checkbox" width="10px">
                                                    <ui:inputCheckbox value=""
                                                                    name="" change="{!c.selectAll}"
                                                                    aura:id="cbox" class="cbox" disabled="{!v.statusDisable}" />
                                                    <span class="slds-checkbox-faux" style="top:-2px;"></span>
                                                    <span class="slds-form-element__label text"></span>
                                                </label>
                                            </th>  -->

                                                <th class="tableHeader" style="padding-left: 10px">
                                                    Price Book
                                                </th>
                                                <th class="tableHeader" style="padding-left: 10px">
                                                    Product
                                                </th>
                                                <th class="tableHeader" style="padding-left: 10px">
                                                    Description
                                                </th>
                                                <th class="tableHeader" style="padding-left: 12px">
                                                    Unit Cost
                                                </th>
                                                <th class="tableHeader" style="padding-left: 12px">
                                                    List Price
                                                </th>

                                                <th class="tableHeader" style="padding-left: 10px">
                                                    Phase
                                                </th>
                                                <th class="tableHeader" style="padding-left: 10px">
                                                    Quantity
                                                </th>
                                                <th class="tableHeader" style="padding-left: 10px">
                                                    Markup %
                                                </th>
                                                <th class="tableHeader" style="padding-left: 10px">
                                                    Discount %
                                                </th>

                                                <!--<th style = "padding-left: 10px">
                                                Discount
                                            </th>
                                            <th style = "padding-left: 10px">
                                                Unit Cost
                                            </th>
                                            <th style = "padding-left: 10px">
                                                Markup %
                                            </th>-->
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <aura:iteration items="{!v.data2}" var="item" indexVar="recIndex">
                                                <tr title="Product">
                                                    <td>
                                                        <lightning:input name="input1" label=""
                                                            value="{!item.buildertek__Size__c}" disabled="true" />
                                                    </td>
                                                    <td>
                                                        <lightning:input name="input1" label="" value="{!item.Name}"
                                                            disabled="true" />
                                                    </td>
                                                    <td>
                                                        <lightning:input name="input3" label=""
                                                            value="{!item.buildertek__Description__c}" />
                                                    </td>
                                                    <td>
                                                        <lightning:input name="input6" label=""
                                                            value="{!item.buildertek__Unit_Cost__c}"
                                                            formatter="currency" type="number" maximumFractionDigits="5"
                                                            step="0.01" />
                                                    </td>
                                                    <td>
                                                        <lightning:input name="input2" label=""
                                                            value="{!item.buildertek__Unit_Price__c}"
                                                            formatter="currency" type="number" maximumFractionDigits="5"
                                                            step="0.01" />
                                                    </td>
                                                    <td>
                                                        <lightning:select name="mySelect" label=""
                                                            value="{!item.buildertek__Grouping__c}">
                                                            <option value="">No Grouping</option>
                                                            <aura:iteration items="{!v.quotelineRecords}" var="rec">
                                                                <aura:if isTrue="{!rec.Name != 'No Grouping'}">
                                                                    <aura:if
                                                                        isTrue="{!(rec.Id == item.buildertek__Grouping__c)}">
                                                                        <option text="{!rec.Name}" value="{!rec.Id}"
                                                                            selected="true" />
                                                                        <aura:set attribute="else">
                                                                            <option text="{!rec.Name}" value="{!rec.Id}"
                                                                                selected="false" />
                                                                        </aura:set>
                                                                    </aura:if>
                                                                </aura:if>
                                                            </aura:iteration>
                                                        </lightning:select>
                                                    </td>
                                                    <td>
                                                        <lightning:input name="input4" label=""
                                                            value="{!item.buildertek__Quantity__c}" />
                                                    </td>
                                                    <td>
                                                        <lightning:input name="input7" label=""
                                                            value="{!item.buildertek__Markup__c}" />
                                                    </td>
                                                    <td>
                                                        <lightning:input name="input5" label=""
                                                            value="{!item.buildertek__Additional_Discount__c}" />
                                                    </td>


                                                </tr>
                                            </aura:iteration>
                                        </tbody>
                                    </table>
                                </div>
                                <aura:if isTrue="{!v.Spinner}">
                                    <div aura:id="spinnerId" class="slds-spinner_container">
                                        <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative"
                                            role="alert">
                                            <span class="slds-assistive-text">Loading</span>
                                            <div class="slds-spinner__dot-a"></div>
                                            <div class="slds-spinner__dot-b"></div>
                                            <div class="custom-loading-text">
                                                <b>Processing, Please Wait</b>
                                            </div>
                                        </div>
                                    </div>
                                </aura:if>
                                <footer class="slds-modal__footer">
                                    <button class="slds-button slds-button_neutral" aria-label="Cancel and close"
                                        onclick="{!c.closeBox2}">Cancel</button>
                                    <button class="slds-button slds-button_neutral" aria-label="Cancel and close"
                                        onclick="{!c.cancelBox}">Back</button>

                                    <button class="slds-button slds-button_brand" onclick="{!c.addQuoteLine}"
                                        disabled="{!v.isDisabled}">Save</button>
                                </footer>
                            </div>
                        </section>
                        <div class="slds-backdrop slds-backdrop--open" id="backdrop"></div>
                    </aura:if>

                </div>
            </div>
        </div>


        <div aura:id="newQuoteItem" />
        <lightning:overlayLibrary aura:id="overlayLib" />
        <lightning:notificationsLibrary aura:id="notifLib" />
    </div>


    <div class="slds-m-around_xx-large">
        <aura:if isTrue="{!v.isBOMmodalOpen}">

            <!-- Modal/Popup Box starts here-->
            <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
                aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
                <div class="slds-modal__container">
                    <!-- Modal/Popup Box Header Starts here-->
                    <header class="slds-modal__header">
                        <lightning:buttonIcon iconName="utility:close" onclick="{! c.closeModel }"
                            alternativeText="close" variant="bare-inverse" class="slds-modal__close" />
                        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Select Fields</h2>
                    </header>
                    <!--Modal/Popup Box Body Starts here-->
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <lightning:select name="field1" label="Select Field 1" value="{!v.valueofField1}">
                            <option text="--None--" value="" />
                            <aura:iteration items="{!v.GroupingOptions}" var="item">
                                <aura:if
                                    isTrue="{! (item.value == v.valueofField2 || item.value == v.valueofField3 || item.value==v.valueofField4)}">
                                    <option text="{!item.label}" value="{!item.value}" disabled="true" />
                                    <aura:set attribute="else">
                                        <option text="{!item.label}" value="{!item.value}" />
                                    </aura:set>
                                </aura:if>
                            </aura:iteration>
                        </lightning:select>
                        <lightning:select name="field2" label="Select Field 2" value="{!v.valueofField2}">
                            <option text="--None--" value="" />
                            <aura:iteration items="{!v.GroupingOptions}" var="item">
                                <aura:if
                                    isTrue="{! (item.value == v.valueofField1 || item.value == v.valueofField3 || item.value==v.valueofField4)}">
                                    <option text="{!item.label}" value="{!item.value}" disabled="true" />
                                    <aura:set attribute="else">
                                        <option text="{!item.label}" value="{!item.value}" />
                                    </aura:set>
                                </aura:if>
                            </aura:iteration>
                        </lightning:select>
                        <lightning:select name="field3" label="Select Field 3" value="{!v.valueofField3}">
                            <option text="--None--" value="" />
                            <aura:iteration items="{!v.GroupingOptions}" var="item">
                                <aura:if
                                    isTrue="{! (item.value == v.valueofField2 || item.value == v.valueofField1 || item.value==v.valueofField4)}">
                                    <option text="{!item.label}" value="{!item.value}" disabled="true" />
                                    <aura:set attribute="else">
                                        <option text="{!item.label}" value="{!item.value}" />
                                    </aura:set>
                                </aura:if>
                            </aura:iteration>
                        </lightning:select>
                        <lightning:select name="field4" label="Select Field 4" value="{!v.valueofField4}">
                            <option text="--None--" value="" />
                            <aura:iteration items="{!v.GroupingOptions}" var="item">
                                <aura:if
                                    isTrue="{! (item.value == v.valueofField2 || item.value == v.valueofField3 || item.value==v.valueofField1)}">
                                    <option text="{!item.label}" value="{!item.value}" disabled="true" />
                                    <aura:set attribute="else">
                                        <option text="{!item.label}" value="{!item.value}"
                                            selected="{!item.selected}" />
                                    </aura:set>
                                </aura:if>
                            </aura:iteration>
                        </lightning:select>
                    </div>
                    <!--Modal/Popup Box Footer Starts here-->
                    <footer class="slds-modal__footer">
                        <lightning:button variant="neutral" label="Cancel" title="Cancel" onclick="{! c.closeModel }" />
                        <lightning:button variant="brand" label="OK" title="OK" onclick="{!c.submitDetails}" />
                    </footer>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open"></div>
        </aura:if>
    </div>

</aura:component>