!function(e,t,n,r){"use strict";function o(t,n){n=n||"",t||e.error("Assertion failed "+n)}function a(e,t){e.parentNode.insertBefore(t,e.nextSibling)}function d(e,t){e.visit(function(e){var n=e.tr;return n&&(n.style.display=e.hide||!t?"none":""),e.expanded?void 0:"skip"})}function i(t){var n,r,a,d=t.parent,i=d?d.children:null;if(i&&i.length>1&&i[0]!==t)for(n=e.inArray(t,i),a=i[n-1],o(a.tr);a.children&&(r=a.children[a.children.length-1],r.tr);)a=r;else a=d;return a}e.ui.fancytree.registerExtension({name:"table",version:"0.2.1",options:{checkboxColumnIdx:null,customStatus:!1,indentation:16,nodeColumnIdx:0},treeInit:function(t){var r,o,a,d=t.tree,i=d.widget.element;for(i.addClass("fancytree-container fancytree-ext-table"),d.tbody=i.find("> tbody")[0],d.columnCount=e("thead >tr >th",i).length,e(d.tbody).empty(),d.rowFragment=n.createDocumentFragment(),o=e("<tr />"),a="",t.options.aria&&(o.attr("role","row"),a=" role='gridcell'"),r=0;r<d.columnCount;r++)t.options.table.nodeColumnIdx===r?o.append("<td"+a+"><span class='fancytree-node' /></td>"):o.append("<td"+a+" />");d.rowFragment.appendChild(o.get(0)),d.statusClassPropName="tr",d.ariaPropName="tr",this.nodeContainerAttrName="tr",this._superApply(arguments),e(d.rootNode.ul).remove(),d.rootNode.ul=null,d.$container=i,this.$container.attr("tabindex",this.options.tabbable?"0":"-1"),this.options.aria&&d.$container.attr("role","treegrid").attr("aria-readonly",!0)},nodeRemoveChildMarkup:function(t){var n=t.node;n.visit(function(t){t.tr&&(e(t.tr).remove(),t.tr=null)})},nodeRemoveMarkup:function(t){var n=t.node;n.tr&&(e(n.tr).remove(),n.tr=null),this.nodeRemoveChildMarkup(t)},nodeRender:function(t,n,r,s,l){var u,p,c,h,f,m,y,v,g=t.tree,x=t.node,C=t.options,b=!x.parent;if(l||(t.hasCollapsedParents=x.parent&&!x.parent.expanded),!b)if(x.tr)n?this.nodeRenderTitle(t):this.nodeRenderStatus(t);else{if(t.hasCollapsedParents)return void x.debug("nodeRender ignored due to unrendered parent");f=g.rowFragment.firstChild.cloneNode(!0),m=i(x),o(m),s===!0&&l?f.style.display="none":r&&t.hasCollapsedParents&&(f.style.display="none"),m.tr?a(m.tr,f):(o(!m.parent,"prev. row must have a tr, or is system root"),g.tbody.appendChild(f)),x.tr=f,x.key&&C.generateIds&&(x.tr.id=C.idPrefix+x.key),x.tr.ftnode=x,C.aria&&e(x.tr).attr("aria-labelledby","ftal_"+x.key),x.span=e("span.fancytree-node",x.tr).get(0),this.nodeRenderTitle(t),C.createNode&&C.createNode.call(g,{type:"createNode"},t)}if(C.renderNode&&C.renderNode.call(g,{type:"renderNode"},t),u=x.children,u&&(b||r||x.expanded))for(c=0,h=u.length;h>c;c++)v=e.extend({},t,{node:u[c]}),v.hasCollapsedParents=v.hasCollapsedParents||!x.expanded,this.nodeRender(v,n,r,s,!0);u&&!l&&(y=x.tr||null,p=g.tbody.firstChild,x.visit(function(e){if(e.tr){if(e.parent.expanded||"none"===e.tr.style.display||(e.tr.style.display="none",d(e,!1)),e.tr.previousSibling!==y){x.debug("_fixOrder: mismatch at node: "+e);var t=y?y.nextSibling:p;g.tbody.insertBefore(e.tr,t)}y=e.tr}}))},nodeRenderTitle:function(t,n){var r,o=t.node,a=t.options;this._superApply(arguments),a.checkbox&&null!=a.table.checkboxColumnIdx&&(r=e("span.fancytree-checkbox",o.span).detach(),e(o.tr).find("td").eq(+a.table.checkboxColumnIdx).html(r)),o.isRoot()||this.nodeRenderStatus(t),!a.table.customStatus&&o.isStatusNode()||a.renderColumns&&a.renderColumns.call(t.tree,{type:"renderColumns"},t)},nodeRenderStatus:function(t){var n,r=t.node,o=t.options;this._superApply(arguments),e(r.tr).removeClass("fancytree-node"),n=(r.getLevel()-1)*o.table.indentation,e(r.span).css({marginLeft:n+"px"})},nodeSetExpanded:function(t,n,r){function o(e){n=n!==!1,d(t.node,n),e?n&&t.options.autoScroll&&!r.noAnimation&&t.node.hasChildren()?t.node.getLastChild().scrollIntoView(!0,{topNode:t.node}).always(function(){r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),a.resolveWith(t.node)}):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),a.resolveWith(t.node)):(r.noEvents||t.tree._triggerNodeEvent(n?"expand":"collapse",t),a.rejectWith(t.node))}var a=new e.Deferred,i=e.extend({},r,{noEvents:!0,noAnimation:!0});return r=r||{},this._super(t,n,i).done(function(){o(!0)}).fail(function(){o(!1)}),a.promise()},nodeSetStatus:function(t,n,r,o){if("ok"===n){var a=t.node,d=a.children?a.children[0]:null;d&&d.isStatusNode()&&e(d.tr).remove()}return this._superApply(arguments)},treeClear:function(e){return this.nodeRemoveChildMarkup(this._makeHookContext(this.rootNode)),this._superApply(arguments)}})}(jQuery,window,document);